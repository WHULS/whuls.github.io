<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/blog/03_16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog/03_32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog/03_16x16.png">
  <link rel="mask-icon" href="/images/blog/03_16x16.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"whuls.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="C++与Node.js协同加密解密，用16进制和Base64的格式表示密钥和密文，完成AES+RSA的双重加密解密算法。">
<meta property="og:type" content="article">
<meta property="og:title" content="Node-RSA, Crypto.js和Crypto++服务端与客户端协同加密">
<meta property="og:url" content="https://whuls.github.io/2021/06/20/Cryptopp-%E5%92%8CCrypto-js%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8D%8F%E5%90%8C%E5%8A%A0%E5%AF%86/index.html">
<meta property="og:site_name" content="林杉的个人博客">
<meta property="og:description" content="C++与Node.js协同加密解密，用16进制和Base64的格式表示密钥和密文，完成AES+RSA的双重加密解密算法。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://whuls.github.io/images/image-20210602214757182.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210602222126273.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210603200243168.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210602223220980.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210602222909560.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210603201053828.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210603202427819.png">
<meta property="og:image" content="https://whuls.github.io/images/image-20210603212737537.png">
<meta property="article:published_time" content="2021-06-19T17:34:04.000Z">
<meta property="article:modified_time" content="2021-06-19T17:35:51.913Z">
<meta property="article:author" content="林杉">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://whuls.github.io/images/image-20210602214757182.png">

<link rel="canonical" href="https://whuls.github.io/2021/06/20/Cryptopp-%E5%92%8CCrypto-js%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8D%8F%E5%90%8C%E5%8A%A0%E5%AF%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Node-RSA, Crypto.js和Crypto++服务端与客户端协同加密 | 林杉的个人博客</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5ef394f44970187e7ab7e57f9ffe9a4e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/whuls" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">林杉的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">69</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">27</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">78</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://whuls.github.io/2021/06/20/Cryptopp-%E5%92%8CCrypto-js%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8D%8F%E5%90%8C%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blog/avatar_136x136.png">
      <meta itemprop="name" content="林杉">
      <meta itemprop="description" content="开发记录 & 思考笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林杉的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Node-RSA, Crypto.js和Crypto++服务端与客户端协同加密
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-20 01:34:04 / 修改时间：01:35:51" itemprop="dateCreated datePublished" datetime="2021-06-20T01:34:04+08:00">2021-06-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>44k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>40 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ol class="post-body-toc"><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#环境说明"><span class="post-body-toc-text">环境说明</span></a></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#Node-RSA的安装与使用"><span class="post-body-toc-text">Node-RSA的安装与使用</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#生成公钥私钥-pem文件"><span class="post-body-toc-text">生成公钥私钥.pem文件</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#读取-pem文件，RSA加密解密"><span class="post-body-toc-text">读取.pem文件，RSA加密解密</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#Crypto-js的安装与使用"><span class="post-body-toc-text">Crypto.js的安装与使用</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#生成随机的密钥"><span class="post-body-toc-text">生成随机的密钥</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#AES加密与解密"><span class="post-body-toc-text">AES加密与解密</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#Crypto-的编译与使用"><span class="post-body-toc-text">Crypto++的编译与使用</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#基本编译过程"><span class="post-body-toc-text">基本编译过程</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#创建C-程序引入Crypto-进行测试"><span class="post-body-toc-text">创建C++程序引入Crypto++进行测试</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#使用动态链接库的方式引入Crypto"><span class="post-body-toc-text">使用动态链接库的方式引入Crypto++</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#MD还是MT？生成不同运行库的方法"><span class="post-body-toc-text">MD还是MT？生成不同运行库的方法</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#使用Crypto-分别完成AES和RSA加密解密"><span class="post-body-toc-text">使用Crypto++分别完成AES和RSA加密解密</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#生成RSA公钥私钥对，进行加密解密"><span class="post-body-toc-text">生成RSA公钥私钥对，进行加密解密</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#AES加密与解密-1"><span class="post-body-toc-text">AES加密与解密</span></a></li></ol></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#C-与JS之间互通的加密和解密函数"><span class="post-body-toc-text">C++与JS之间互通的加密和解密函数</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#C-实现的AES加密解密函数"><span class="post-body-toc-text">C++实现的AES加密解密函数</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#1-16进制字符串-转-字节数组"><span class="post-body-toc-text">1. 16进制字符串 转 字节数组</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#2-字节数组-转-16进制字符串"><span class="post-body-toc-text">2. 字节数组 转 16进制字符串</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#3-16进制编码：字符串-转为-16进制字符串"><span class="post-body-toc-text">3. 16进制编码：字符串 转为 16进制字符串</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#4-16进制解码：16进制字符串-转为-字符串"><span class="post-body-toc-text">4. 16进制解码：16进制字符串 转为 字符串</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#5-AES-加密"><span class="post-body-toc-text">5. AES 加密</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#6-AES-解密"><span class="post-body-toc-text">6. AES 解密</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#调用结果"><span class="post-body-toc-text">调用结果</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#JS实现的AES加密解密函数"><span class="post-body-toc-text">JS实现的AES加密解密函数</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#1-16进制随机字符串生成"><span class="post-body-toc-text">1. 16进制随机字符串生成</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#2-AES-加密"><span class="post-body-toc-text">2. AES 加密</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#3-AES-解密"><span class="post-body-toc-text">3. AES 解密</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#调用结果-1"><span class="post-body-toc-text">调用结果</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#C-实现的RSA加密解密函数"><span class="post-body-toc-text">C++实现的RSA加密解密函数</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#1-生成RSA密钥对"><span class="post-body-toc-text">1. 生成RSA密钥对</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#2-保存和读取RSA密钥对"><span class="post-body-toc-text">2. 保存和读取RSA密钥对</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#3-RSA加密解密"><span class="post-body-toc-text">3. RSA加密解密</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#调用示例"><span class="post-body-toc-text">调用示例</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#JS实现的RSA加密解密函数"><span class="post-body-toc-text">JS实现的RSA加密解密函数</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#C-与JS的配合使用的AES-RSA双重加密"><span class="post-body-toc-text">C++与JS的配合使用的AES+RSA双重加密</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#加密说明示例"><span class="post-body-toc-text">加密说明示例</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#纯C-实现"><span class="post-body-toc-text">纯C++实现</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#纯JS实现"><span class="post-body-toc-text">纯JS实现</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#C-加密，JS解密"><span class="post-body-toc-text">C++加密，JS解密</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#JS加密，C-加密"><span class="post-body-toc-text">JS加密，C++加密</span></a></li></ol></li></ol>
      
      
        <h1 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h1><p>客户端：C++</p>
<p>服务端：Node.js</p>
<p>需要在客户端与服务端进行加密通讯，首先考虑使用RSA算法进行加密，该算法要求数据长度不能超过密钥长度，因此通常用来加密一些较短的数据，考虑使用AES对数据进行加密，使用RSA对AES密钥进行加密，以此充分利用算法的特性，实现加密过程。</p>
<h1 id="Node-RSA的安装与使用"><a href="#Node-RSA的安装与使用" class="headerlink" title="Node-RSA的安装与使用"></a>Node-RSA的安装与使用</h1><blockquote>
<p><a href="https://www.npmjs.com/package/node-rsa" target="_blank" rel="noopener">https://www.npmjs.com/package/node-rsa</a></p>
</blockquote>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i node-rsa -S</span><br></pre></td></tr></table></figure>
<h2 id="生成公钥私钥-pem文件"><a href="#生成公钥私钥-pem文件" class="headerlink" title="生成公钥私钥.pem文件"></a>生成公钥私钥.pem文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> NodeRSA = <span class="built_in">require</span>(<span class="string">'node-rsa'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 生成RSA对</span></span><br><span class="line">    <span class="keyword">const</span> key = <span class="keyword">new</span> NodeRSA(&#123; <span class="attr">b</span>: <span class="number">2048</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出为pem文件</span></span><br><span class="line">    <span class="keyword">const</span> outDir = path.join(__dirname, <span class="string">'rsa'</span>);</span><br><span class="line">    <span class="keyword">if</span> (!fs.existsSync(outDir)) &#123;</span><br><span class="line">        fs.mkdirSync(outDir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fs.writeFileSync(path.join(outDir, <span class="string">'pub.pem'</span>), key.exportKey(<span class="string">'pkcs8-public-pem'</span>));</span><br><span class="line">    fs.writeFileSync(path.join(outDir, <span class="string">'pri.pem'</span>), key.exportKey(<span class="string">'pkcs8-private-pem'</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码首先生成了一个长度为<code>2048</code>位的密钥，接着在指定文件夹下分别输出公钥和私钥文件，输出的格式为<code>pkcs8</code>，pem表示加密格式为base64。</p>
<h2 id="读取-pem文件，RSA加密解密"><a href="#读取-pem文件，RSA加密解密" class="headerlink" title="读取.pem文件，RSA加密解密"></a>读取.pem文件，RSA加密解密</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> NodeRSA = <span class="built_in">require</span>(<span class="string">'node-rsa'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keyDir = path.join(__dirname, <span class="string">'rsa'</span>);</span><br><span class="line">    <span class="keyword">const</span> pubKey = <span class="keyword">new</span> NodeRSA(fs.readFileSync(path.join(keyDir, <span class="string">'pub.pem'</span>)), <span class="string">'pkcs8-public-pem'</span>, &#123; <span class="attr">encryptionScheme</span>: <span class="string">'pkcs1'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> priKey = <span class="keyword">new</span> NodeRSA(fs.readFileSync(path.join(keyDir, <span class="string">'pri.pem'</span>)), <span class="string">'pkcs8-private-pem'</span>, &#123; <span class="attr">encryptionScheme</span>: <span class="string">'pkcs1'</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> msg = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        text: <span class="string">'Hello World'</span>,</span><br><span class="line">        time: <span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> encMsg = pubKey.encrypt(msg, <span class="string">'base64'</span>, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(encMsg);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decMsg = priKey.decrypt(encMsg, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(decMsg);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Crypto-js的安装与使用"><a href="#Crypto-js的安装与使用" class="headerlink" title="Crypto.js的安装与使用"></a>Crypto.js的安装与使用</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i crypto-js -S</span><br></pre></td></tr></table></figure>
<h2 id="生成随机的密钥"><a href="#生成随机的密钥" class="headerlink" title="生成随机的密钥"></a>生成随机的密钥</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成随机的16进制密钥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>len 密钥长度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>密钥字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> randomKey = <span class="function">(<span class="params">len</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        str += <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">16</span>).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="AES加密与解密"><a href="#AES加密与解密" class="headerlink" title="AES加密与解密"></a>AES加密与解密</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> msg = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        text: <span class="string">'Hello World!'</span>,</span><br><span class="line">        time: <span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> key = randomKey(<span class="number">8</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'key: %s'</span>, key);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> enc = CryptoJS.AES.encrypt(msg, key).toString();</span><br><span class="line">    <span class="built_in">console</span>.log(enc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> dec = CryptoJS.AES.decrypt(enc, key).toString(CryptoJS.enc.Utf8);</span><br><span class="line">    <span class="built_in">console</span>.log(dec);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Crypto-的编译与使用"><a href="#Crypto-的编译与使用" class="headerlink" title="Crypto++的编译与使用"></a>Crypto++的编译与使用</h1><p>Crypto++是基于C++实现的一个加密算法库，我们用它来实现AES和RSA加密解密流程。</p>
<h2 id="基本编译过程"><a href="#基本编译过程" class="headerlink" title="基本编译过程"></a>基本编译过程</h2><blockquote>
<p><a href="https://www.cryptopp.com/index.html#download" target="_blank" rel="noopener">下载地址：Cryptopp.com</a></p>
<p>编译器：VS2019</p>
</blockquote>
<p>下载后解压，解压后先把所有的<code>.h</code>和<code>.cpp</code>文件拷贝到一个目录下，放在<code>include/cryptopp</code>下。</p>
<p>使用VS打开目录下的<code>cryptest.sln</code>文件，里面包含了4个项目，其中我们需要用到的有两个：<code>cryptdll</code>和<code>cryptlib</code>，分别对应动态库（lib+dll）和静态库（lib）。在“生成-批生成”中分别选择对应项目的32位和64位的Debug和Release版本，总共四个，全都勾上，点击【生成】，全程大约花费3-5min，时间和CPU性能有关系。</p>
<p><img src="/images/image-20210602214757182.png" alt="image-20210602214757182" style="zoom:50%;" /></p>
<p>生成的结果保存在<code>.sln</code>文件同一目录下的<code>Win32</code>和<code>x64</code>文件夹下，需要把里面我们需要用到的东西取出放到特定的文件夹下。创建两个文件夹shared和static，在每个文件夹下创建四个目录，分别对应32位和64位下的Debug和Release库文件，对应的拷贝关系如下所示：</p>
<ul>
<li>Win32/Output/Debug/* -&gt; <code>static/debug-v142</code></li>
<li>Win32/Output/Release/* -&gt; <code>static/release-v142</code></li>
<li>x64/Output/Debug/* -&gt; <code>static/debug-x64-v142</code></li>
<li>x64/Output/Release/* -&gt; <code>static/release-x64-v142</code></li>
<li>Win32/DLL_Output/Debug/* -&gt; <code>shared/debug-v142</code></li>
<li>Win32/DLL_Output/Release/* -&gt; <code>shared/release-v142</code></li>
<li>x64/DLL_Output/Debug/* -&gt; <code>shared/debug-x64-v142</code></li>
<li>x64/DLL_Output/Release/* -&gt; <code>shared/release-x64-v142</code></li>
</ul>
<p>使用shared和static区分动态库和静态库，shared存放的一般包括.dll和.lib文件，static存放的只有一个.lib文件。拷贝的内容为对应文件夹下的.dll和.lib文件，其他的文件如.pdb, .ilk, .exp可选复制。这边的v142标识了编译器的版本，对应MSVC2019。</p>
<h2 id="创建C-程序引入Crypto-进行测试"><a href="#创建C-程序引入Crypto-进行测试" class="headerlink" title="创建C++程序引入Crypto++进行测试"></a>创建C++程序引入Crypto++进行测试</h2><p>在VS2019中新建工程，在工程中引入Crypto++。在“项目-属性-C/C++-附加包含目录”输入include目录的绝对路径：</p>
<p><img src="/images/image-20210602222126273.png" alt="image-20210602222126273" style="zoom:50%;" /></p>
<p>接着根据配置（Debug/Release）和平台（x64/Win32），在“链接器-输入-附加依赖项”引入对应文件夹中的.lib文件，这里引入的是静态库文件（static），这也是这个库的作者推荐的使用方式，不需要额外添加.dll文件到.exe文件目录下或环境变量中，生成成功后可以直接运行。</p>
<p><img src="/images/image-20210603200243168.png" alt="image-20210603200243168" style="zoom:50%;" /></p>
<p>由于Crypto++的工程文件默认生成MT的运行库，因此还需要额外修改“C/C++-代码生成-运行库”，Debug版本选择<code>/MTD</code>，Release版本选择<code>/MT</code>。（如果不想修改这个设置，见后续小节）</p>
<p><img src="/images/image-20210602223220980.png" alt="image-20210602223220980" style="zoom:50%;" /></p>
<p>两个地方引入完成后，创建一个.cpp，在里面写入如下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/aes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> CryptoPP::<span class="keyword">byte</span> <span class="keyword">byte</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CryptoPP::AESEncryption aesEncryptor;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">byte</span> aesKey[CryptoPP::AES::DEFAULT_KEYLENGTH];</span><br><span class="line">	<span class="keyword">byte</span> inBlock[CryptoPP::AES::BLOCKSIZE] = <span class="string">"123456789"</span>;</span><br><span class="line">	<span class="keyword">byte</span> outBlock[CryptoPP::AES::BLOCKSIZE];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">byte</span> xorBlock[CryptoPP::AES::BLOCKSIZE];</span><br><span class="line">	<span class="built_in">memset</span>(xorBlock, <span class="number">0</span>, CryptoPP::AES::BLOCKSIZE);</span><br><span class="line"></span><br><span class="line">	aesEncryptor.SetKey(aesKey, CryptoPP::AES::DEFAULT_KEYLENGTH);</span><br><span class="line">	aesEncryptor.ProcessAndXorBlock(inBlock, xorBlock, outBlock);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::hex &lt;&lt; (<span class="keyword">int</span>)outBlock[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果配置正确，执行代码后将在命令行中输出如下信息：</p>
<p><img src="/images/image-20210602222909560.png" alt="image-20210602222909560" style="zoom:50%;" /></p>
<h2 id="使用动态链接库的方式引入Crypto"><a href="#使用动态链接库的方式引入Crypto" class="headerlink" title="使用动态链接库的方式引入Crypto++"></a>使用动态链接库的方式引入Crypto++</h2><p>上一小节记录了作者推荐的静态库的引入方式，如果有特别的需求需要用到.lib+.dll的动态库组合，需要进行额外的设置。</p>
<p>在<a href="https://github.com/weidai11/cryptopp" target="_blank" rel="noopener">Crypto++的代码仓库</a>中有这么一段说明：</p>
<blockquote>
<p><u>To use the Crypto++ DLL in your application, #include “dll.h” before including</u><br><u>any other Crypto++ header files, and place the DLL in the same directory as</u><br><u>your .exe file. dll.h includes the line #pragma comment(lib, “cryptopp”)</u><br><u>so you don’t have to explicitly list the import library in your project</u><br><u>settings.</u> To use a static library form of Crypto++, make the “cryptlib”<br>project a dependency of your application project, or specify it as<br>an additional library to link with in your project settings.<br>In either case you should check the compiler options to<br>make sure that the library and your application are using the same C++<br>run-time libraries and calling conventions.</p>
</blockquote>
<p>因此，在工程配置中，将引入的静态库改为动态库：</p>
<p><img src="/images/image-20210603201053828.png" alt="image-20210603201053828" style="zoom:50%;" /></p>
<p>接着在代码的头文件处引入<code>dll.h</code>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/dll.h&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>最后把对应的.dll文件<code>cryptopp.dll</code>拷贝到.exe目录下，即可运行。如果在VS中运行Debug版本抛出异常，按下F5继续执行即可，或者直接Ctrl+F5执行不调试也可以正确输出，发生的异常属于Crypto++内部的小BUG，无伤大雅。</p>
<p>使用动态库生成的.exe文件会小很多，且频繁运行时可以充分利用系统的缓存机制，运行速度快；使用静态库生成的.exe文件较大，但是只有一个文件，较为简洁，便于传递。</p>
<p><img src="/images/image-20210603202427819.png" alt="image-20210603202427819" style="zoom:50%;" /></p>
<h2 id="MD还是MT？生成不同运行库的方法"><a href="#MD还是MT？生成不同运行库的方法" class="headerlink" title="MD还是MT？生成不同运行库的方法"></a>MD还是MT？生成不同运行库的方法</h2><p>MD意为：multithread and DLL-specific version，多线程DLL版本。编译器加载的是动态运行的库，依赖.lib和.dll文件。</p>
<p>MT意为：multithread, static version, 多线程静态版本。编译器加载的是静态运行的库，仅依赖.lib文件。</p>
<p>若生成工程时使用的是<code>/MT</code>生成的，它所调用的运行时库为：<code>LIBCMT.lib</code>，编译器将其安置到.obj文件中，让链接器使用<code>LIBCMT.lib</code>处理外部符号，并完成相关的运算操作（一个文件完成）；</p>
<p>若生成工程时使用的是<code>/MD</code>生成的，调用的运行库有两个：<code>MSVCRT.lib</code>和<code>MSVCRxxx.dll</code>，这里xxx对应MSVC版本，如VS2019使用的MSVC2019，调用的.dll文件为<code>MSVCR142.dll</code>。MSVC2017对应141，MSVC2015对应140，MSVC2013对应120，MSVC2010对应100。编译器将<code>MSVCRT.lib</code>安置到.obj文件中，与<code>MSVCRxxx.dll</code>建立静态链接，由.lib完成外部符号处理，相关的运算交给.dll文件（两个文件完成）；</p>
<p>因此，若一个生成运行库的工程使用的是<code>/MT</code>方式生成，调用的运行库是<code>LIBCMT.lib</code>，在另一个工程中引用这个库时，若这个工程使用的是<code>/MD</code>方式生成，调用的运行库是<code>MSVCRT.lib</code>和<code>MSVCRxxx.dll</code>，当调用某个系统库函数时，若两个运行库中均有这个函数，就会出现重定义的错误。因此当在另一个工程中使用由其他工程生成的库文件时，在“属性-C/C++-代码生成”中的运行库设置一定需要一至。</p>
<p>在Crypto++的.sln文件中，四个工程的默认运行库都是<code>/MT</code>，因此生成库文件要在别的工程中使用，该工程需要将运行库也一同设置为<code>/MT</code>。此时的矛盾点在于，使用VS创建的工程默认都是<code>/MD</code>，有一些现有的工程都是使用<code>/MD</code>的运行库，因此要进行嵌入的话，必须适配。</p>
<p><img src="/images/image-20210603212737537.png" alt="image-20210603212737537" style="zoom:50%;" /></p>
<p>修改不同运行库的方法很简单，右键两个工程<code>cryptdll</code>和<code>cryptlib</code>，在“属性-C/C++-代码生成-运行库”位置全都改成<code>/MD</code>相关，Debug就改成<code>/MDd</code>，<code>/Release</code>改成<code>/MD</code>，改完之后，按照上述小节的基本编译过程进行编译和结果输出，即可保存使用。</p>
<h2 id="使用Crypto-分别完成AES和RSA加密解密"><a href="#使用Crypto-分别完成AES和RSA加密解密" class="headerlink" title="使用Crypto++分别完成AES和RSA加密解密"></a>使用Crypto++分别完成AES和RSA加密解密</h2><blockquote>
<p>RSA:</p>
<p><a href="https://cryptopp.com/wiki/RSA_Cryptography#Encryption_Scheme_.28OAEP_using_SHA.29" target="_blank" rel="noopener">RSA Cryptography - Encryption Scheme (OAEP using SHA)</a></p>
<p>AES:</p>
<p><a href="https://cryptopp.com/wiki/Advanced_Encryption_Standard" target="_blank" rel="noopener">Advanced Encryption Standard - Crypto++ Wiki</a></p>
</blockquote>
<p>在C++中实现AES和RSA加密解密借助Crypto++来实现，这里引用官网的两个示例来演示如何通过C++代码实现加密解密流程。</p>
<h3 id="生成RSA公钥私钥对，进行加密解密"><a href="#生成RSA公钥私钥对，进行加密解密" class="headerlink" title="生成RSA公钥私钥对，进行加密解密"></a>生成RSA公钥私钥对，进行加密解密</h3><p>Crypto++官网示例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Generate keys</span></span><br><span class="line">AutoSeededRandomPool rng;</span><br><span class="line"></span><br><span class="line">InvertibleRSAFunction params;</span><br><span class="line">params.GenerateRandomWithKeySize(rng, <span class="number">3072</span>);</span><br><span class="line"></span><br><span class="line"><span class="function">RSA::PrivateKey <span class="title">privateKey</span><span class="params">(params)</span></span>;</span><br><span class="line"><span class="function">RSA::PublicKey <span class="title">publicKey</span><span class="params">(params)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> plain = <span class="string">"RSA Encryption"</span>, cipher, recovered;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Encryption</span></span><br><span class="line"><span class="function">RSAES_OAEP_SHA_Encryptor <span class="title">e</span><span class="params">(publicKey)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">StringSource <span class="title">ss1</span><span class="params">(plain, <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">new</span> PK_EncryptorFilter(rng, e,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">new</span> StringSink(cipher)</span></span></span><br><span class="line"><span class="function"><span class="params">	) <span class="comment">// PK_EncryptorFilter</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>; <span class="comment">// StringSource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Decryption</span></span><br><span class="line"><span class="function">RSAES_OAEP_SHA_Decryptor <span class="title">d</span><span class="params">(privateKey)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">StringSource <span class="title">ss2</span><span class="params">(cipher, <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">new</span> PK_DecryptorFilter(rng, d,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">new</span> StringSink(recovered)</span></span></span><br><span class="line"><span class="function"><span class="params">	) <span class="comment">// PK_DecryptorFilter</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>; <span class="comment">// StringSource</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Recovered plain text"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>
<h3 id="AES加密与解密-1"><a href="#AES加密与解密-1" class="headerlink" title="AES加密与解密"></a>AES加密与解密</h3><p>Crypto++官网示例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"cryptlib.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"rijndael.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"modes.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"files.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"osrng.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hex.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line"></span><br><span class="line">    AutoSeededRandomPool prng;</span><br><span class="line">    <span class="function">HexEncoder <span class="title">encoder</span><span class="params">(<span class="keyword">new</span> FileSink(<span class="built_in">std</span>::<span class="built_in">cout</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">SecByteBlock <span class="title">key</span><span class="params">(AES::DEFAULT_KEYLENGTH)</span></span>;</span><br><span class="line">    <span class="function">SecByteBlock <span class="title">iv</span><span class="params">(AES::BLOCKSIZE)</span></span>;</span><br><span class="line"></span><br><span class="line">    prng.GenerateBlock(key, key.<span class="built_in">size</span>());</span><br><span class="line">    prng.GenerateBlock(iv, iv.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> plain = <span class="string">"CBC Mode Test"</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> cipher, recovered;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"plain text: "</span> &lt;&lt; plain &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************\</span></span><br><span class="line"><span class="comment">    \*********************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        CBC_Mode&lt; AES &gt;::Encryption e;</span><br><span class="line">        e.SetKeyWithIV(key, key.<span class="built_in">size</span>(), iv);</span><br><span class="line"></span><br><span class="line">        <span class="function">StringSource <span class="title">s</span><span class="params">(plain, <span class="literal">true</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">new</span> StreamTransformationFilter(e,</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">new</span> StringSink(cipher)</span></span></span><br><span class="line"><span class="function"><span class="params">            ) <span class="comment">// StreamTransformationFilter</span></span></span></span><br><span class="line"><span class="function"><span class="params">        )</span></span>; <span class="comment">// StringSource</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">const</span> Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*********************************\</span></span><br><span class="line"><span class="comment">    \*********************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"key: "</span>;</span><br><span class="line">    encoder.Put(key, key.<span class="built_in">size</span>());</span><br><span class="line">    encoder.MessageEnd();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"iv: "</span>;</span><br><span class="line">    encoder.Put(iv, iv.<span class="built_in">size</span>());</span><br><span class="line">    encoder.MessageEnd();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"cipher text: "</span>;</span><br><span class="line">    encoder.Put((<span class="keyword">const</span> <span class="keyword">byte</span>*)&amp;cipher[<span class="number">0</span>], cipher.<span class="built_in">size</span>());</span><br><span class="line">    encoder.MessageEnd();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*********************************\</span></span><br><span class="line"><span class="comment">    \*********************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        CBC_Mode&lt; AES &gt;::Decryption d;</span><br><span class="line">        d.SetKeyWithIV(key, key.<span class="built_in">size</span>(), iv);</span><br><span class="line"></span><br><span class="line">        <span class="function">StringSource <span class="title">s</span><span class="params">(cipher, <span class="literal">true</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">new</span> StreamTransformationFilter(d,</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">new</span> StringSink(recovered)</span></span></span><br><span class="line"><span class="function"><span class="params">            ) <span class="comment">// StreamTransformationFilter</span></span></span></span><br><span class="line"><span class="function"><span class="params">        )</span></span>; <span class="comment">// StringSource</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"recovered text: "</span> &lt;&lt; recovered &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="keyword">const</span> Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="C-与JS之间互通的加密和解密函数"><a href="#C-与JS之间互通的加密和解密函数" class="headerlink" title="C++与JS之间互通的加密和解密函数"></a>C++与JS之间互通的加密和解密函数</h1><p>为了在C++和JS之间进行数据传输通信，需要设定一个统一的数据交互格式。在这里的设计中，AES密钥表示为16进制字符串，通过AES加密后的内容仍为16进制字符串；RSA公钥私钥对通过.pem文件存储，密钥内容由Base64编码（为了迎合CryptoJS），通过RSA公钥加密后的数据为Base64编码后的字符串。</p>
<h2 id="C-实现的AES加密解密函数"><a href="#C-实现的AES加密解密函数" class="headerlink" title="C++实现的AES加密解密函数"></a>C++实现的AES加密解密函数</h2><p>在Crypto++中，喂给加密解密函数的密钥的数据类型是字节数组，而生成的用于传输的密文、密钥、偏移量是16进制的字符串，因此需要首先实现字节数组和16进制字符串之间的转换。</p>
<p>头文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/rijndael.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/modes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/osrng.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/hex.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/files.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="1-16进制字符串-转-字节数组"><a href="#1-16进制字符串-转-字节数组" class="headerlink" title="1. 16进制字符串 转 字节数组"></a>1. 16进制字符串 转 字节数组</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 16进制字符串转为字节数组</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="hexStr"&gt;16进制字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;字节数组&lt;/returns&gt;</span></span><br><span class="line"><span class="function">CryptoPP::SecByteBlock <span class="title">HexString2ByteBlock</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> hexStr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	</span><br><span class="line">	<span class="function">SecByteBlock <span class="title">byteBlock</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> byteStr;</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">(hexStr, <span class="literal">true</span>, <span class="keyword">new</span> HexDecoder(<span class="keyword">new</span> StringSink(byteStr)))</span></span>;</span><br><span class="line"></span><br><span class="line">		byteBlock.Assign((<span class="keyword">const</span> <span class="keyword">byte</span>*)&amp;byteStr[<span class="number">0</span>], byteStr.<span class="built_in">size</span>());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> byteBlock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-字节数组-转-16进制字符串"><a href="#2-字节数组-转-16进制字符串" class="headerlink" title="2. 字节数组 转 16进制字符串"></a>2. 字节数组 转 16进制字符串</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 字节数组转16进制字符串</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="byteBlock"&gt;字节数组&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;16进制字符串&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">ByteBlock2HexString</span><span class="params">(CryptoPP::SecByteBlock byteBlock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> str;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">(byteBlock, byteBlock.<span class="built_in">size</span>(), <span class="literal">true</span>, <span class="keyword">new</span> HexEncoder(<span class="keyword">new</span> StringSink(str)))</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-16进制编码：字符串-转为-16进制字符串"><a href="#3-16进制编码：字符串-转为-16进制字符串" class="headerlink" title="3. 16进制编码：字符串 转为 16进制字符串"></a>3. 16进制编码：字符串 转为 16进制字符串</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 将由char组成的字符串转为16进制字符串</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="cStr"&gt;字符串, 每一位是一个char(-128~127)&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;16进制字符串&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">String2HexString</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> cStr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> str;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">((<span class="keyword">const</span> <span class="keyword">byte</span>*)&amp;cStr[<span class="number">0</span>], cStr.<span class="built_in">size</span>(), <span class="literal">true</span>, <span class="keyword">new</span> HexEncoder(<span class="keyword">new</span> StringSink(str)))</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-16进制解码：16进制字符串-转为-字符串"><a href="#4-16进制解码：16进制字符串-转为-字符串" class="headerlink" title="4. 16进制解码：16进制字符串 转为 字符串"></a>4. 16进制解码：16进制字符串 转为 字符串</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 16进制字符串转为由char组成的字符串</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="hexStr"&gt;16进制字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;由char组成的字符串&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">HexString2String</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> hexStr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> str;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">(hexStr, <span class="literal">true</span>, <span class="keyword">new</span> HexDecoder(<span class="keyword">new</span> StringSink(str)))</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-AES-加密"><a href="#5-AES-加密" class="headerlink" title="5. AES 加密"></a>5. AES 加密</h3><p>加密时，首先将16进制字符串的密钥key和偏移iv转为字节数组，再调用Crypto++相关的函数进行加密。若密钥和偏移字符串为空，则根据指定的长度生成随机的密钥和偏移字符串。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// AES加密</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="str"&gt;待加密的字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="encStr"&gt;指针: 加密后的字符串, 为16进制数组成的字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="key"&gt;指针: 密钥, 若为空指针或长度为0, 则根据keyLen长度生成&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="iv"&gt;指针: 偏移量, 若为空指针或长度为0, 则根据ivLen长度生成&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="keyLen"&gt;密钥长度, 默认16, 若密钥指针不为空, 该参数失效&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="ivLen"&gt;偏移量长度, 默认为16, 若偏移量指针不为空, 该参数失效&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;是否加密成功&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">AesEncrypt</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="built_in">std</span>::<span class="built_in">string</span>* hexEncStr = <span class="literal">nullptr</span>, <span class="built_in">std</span>::<span class="built_in">string</span>* hexKeyStr = <span class="literal">nullptr</span>, <span class="built_in">std</span>::<span class="built_in">string</span>* hexIvStr = <span class="literal">nullptr</span>, <span class="keyword">int</span> keyLen = <span class="number">16</span>, <span class="keyword">int</span> ivLen = <span class="number">16</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (hexEncStr == <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"未为加密字符串分配空间"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (str.empty())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"待加密的字符串为空"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果key或iv为空指针, 说明不需要输出, 需要在函数执行完成后删除变量</span></span><br><span class="line">	<span class="keyword">bool</span> isDelKey, isDelIv;</span><br><span class="line">	isDelKey = isDelIv = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">if</span> (hexKeyStr == <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		hexKeyStr = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="built_in">string</span>();</span><br><span class="line">		isDelKey = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hexIvStr == <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		hexIvStr = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="built_in">string</span>();</span><br><span class="line">		isDelIv = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> isSucceed = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		* 获取密钥和偏移量的字节数组, 若key或iv长度为0, 生成随机字符串</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		SecByteBlock byteKey;</span><br><span class="line">		SecByteBlock byteIv;</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (hexKeyStr-&gt;<span class="built_in">size</span>() != <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				keyLen = <span class="keyword">int</span>(hexKeyStr-&gt;<span class="built_in">size</span>() / <span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (keyLen != <span class="number">8</span> &amp;&amp; keyLen != <span class="number">16</span> &amp;&amp; keyLen != <span class="number">32</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="built_in">std</span>::exception((<span class="string">"密钥长度错误: "</span> + <span class="built_in">std</span>::to_string(keyLen)).c_str());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (hexKeyStr-&gt;<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// 生成随机的key</span></span><br><span class="line">				byteKey.New(keyLen);</span><br><span class="line">				AutoSeededRandomPool prng;</span><br><span class="line">				prng.GenerateBlock(byteKey, byteKey.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 转为字符串</span></span><br><span class="line">				*hexKeyStr = ByteBlock2HexString(byteKey);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				byteKey = HexString2ByteBlock(*hexKeyStr);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (hexIvStr-&gt;<span class="built_in">size</span>() != <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				ivLen = <span class="keyword">int</span>(hexIvStr-&gt;<span class="built_in">size</span>() / <span class="number">2</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (ivLen != <span class="number">8</span> &amp;&amp; ivLen != <span class="number">16</span> &amp;&amp; ivLen != <span class="number">32</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="built_in">std</span>::exception((<span class="string">"偏移量长度错误: "</span> + <span class="built_in">std</span>::to_string(ivLen)).c_str());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (hexIvStr-&gt;<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// 生成随机的iv</span></span><br><span class="line">				byteIv.New(ivLen);</span><br><span class="line">				AutoSeededRandomPool prng;</span><br><span class="line">				prng.GenerateBlock(byteIv, byteIv.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 转为字符串</span></span><br><span class="line">				*hexIvStr = ByteBlock2HexString(byteIv);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				byteIv = HexString2ByteBlock(*hexIvStr);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 加密</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> encStrByte;</span><br><span class="line">		&#123;</span><br><span class="line">			CBC_Mode&lt;AES&gt;::Encryption e;</span><br><span class="line">			e.SetKeyWithIV(byteKey, byteKey.<span class="built_in">size</span>(), byteIv, byteIv.<span class="built_in">size</span>());</span><br><span class="line">			<span class="function">StringSource <span class="title">s</span><span class="params">(str, <span class="literal">true</span>, <span class="keyword">new</span> StreamTransformationFilter(e, <span class="keyword">new</span> StringSink(encStrByte)))</span></span>;</span><br><span class="line">		&#125;</span><br><span class="line">		*hexEncStr = String2HexString(encStrByte);</span><br><span class="line"></span><br><span class="line">		isSucceed = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		isSucceed = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (isDelKey) <span class="keyword">delete</span> hexKeyStr;</span><br><span class="line">	<span class="keyword">if</span> (isDelIv) <span class="keyword">delete</span> hexIvStr;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> isSucceed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-AES-解密"><a href="#6-AES-解密" class="headerlink" title="6. AES 解密"></a>6. AES 解密</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// AES 解密</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="hexEncStr"&gt;16进制的加密字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="hexKeyStr"&gt;16进制的密钥字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="hexIvStr"&gt;16进制的偏移量字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="decStr"&gt;解密后的字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;是否解密成功&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">AesDecrypt</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> hexEncStr, <span class="built_in">std</span>::<span class="built_in">string</span> hexKeyStr, <span class="built_in">std</span>::<span class="built_in">string</span> hexIvStr, <span class="built_in">std</span>::<span class="built_in">string</span>* decStr = <span class="literal">nullptr</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (decStr == <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"输出指针为空"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">bool</span> isSucceed = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 将16进制转为字节数组</span></span><br><span class="line">		SecByteBlock key, iv;</span><br><span class="line">		key = HexString2ByteBlock(hexKeyStr);</span><br><span class="line">		iv = HexString2ByteBlock(hexIvStr);</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> cStr = HexString2String(hexEncStr);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 解密</span></span><br><span class="line">		CBC_Mode&lt;AES&gt;::Decryption d;</span><br><span class="line">		d.SetKeyWithIV(key, key.<span class="built_in">size</span>(), iv, iv.<span class="built_in">size</span>());</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">(cStr, <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">new</span> StreamTransformationFilter(d,</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">new</span> StringSink(*decStr)</span></span></span><br><span class="line"><span class="function"><span class="params">			)</span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span>;</span><br><span class="line"></span><br><span class="line">		isSucceed = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		isSucceed = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> isSucceed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用结果"><a href="#调用结果" class="headerlink" title="调用结果"></a>调用结果</h3><p>调用：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> str, key, iv, encStr, decStr;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line">&#123;</span><br><span class="line">	str = <span class="string">"AES CBC Encrypt, Test, Hello World!!!!!"</span>;</span><br><span class="line">	<span class="keyword">if</span> (AesEncrypt(str, &amp;encStr, &amp;key, &amp;iv))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"key: "</span> &lt;&lt; key &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"iv: "</span> &lt;&lt; iv &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"encStr: "</span> &lt;&lt; encStr &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"加密失败"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (AesDecrypt(encStr, key, iv, &amp;decStr))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"decStr: "</span> &lt;&lt; decStr &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"解密失败"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key: D486B7316C9F9F69078D031DB1499E58</span><br><span class="line">iv: 6A8C943C59F23D9ECE3C09934F5464DA</span><br><span class="line">encStr: 4CA2770DE3FB68D7E17F46B87A1E2689794835A63B1D0A7E2AC10139F018093F13079967ECECBC9046A522D3E8A29B7D</span><br><span class="line">decStr: AES CBC Encrypt, Test, Hello World!!!!!</span><br></pre></td></tr></table></figure>
<h2 id="JS实现的AES加密解密函数"><a href="#JS实现的AES加密解密函数" class="headerlink" title="JS实现的AES加密解密函数"></a>JS实现的AES加密解密函数</h2><p>通过调用CryptoJS实现AES加密解密，需要注意的是输出的参数类型，用于与C++通信的数据格式为16进制字符串，因此需要针对16进制的密文、密钥、偏移量做解析，进而完成加密解密。</p>
<p>这里的密钥长度和偏移量长度指的是将16进制字符串转为字节数组后的长度，存在一个2倍的关系，即：<strong>16进制字符串</strong>的长度除以2得到<strong>由字节数组构成的密钥</strong>的长度。</p>
<h3 id="1-16进制随机字符串生成"><a href="#1-16进制随机字符串生成" class="headerlink" title="1. 16进制随机字符串生成"></a>1. 16进制随机字符串生成</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成指定长度的16进制字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>len 字符串长度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>16进制字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> randomHexStr = <span class="function">(<span class="params">len</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        str += <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">16</span>).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-AES-加密"><a href="#2-AES-加密" class="headerlink" title="2. AES 加密"></a>2. AES 加密</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AES 加密</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>str 待加密的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>hexKeyStr 16进制的密钥字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>hexIvStr 16进制的偏移量字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>keyLen 密钥字符串长度, 当16进制密钥字符串为0时生效</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>ivLen 偏移量字符串长度, 当16进制偏移字符串为0时生效</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Object&#125;</span> </span>16进制的密文/密钥/偏移量 &#123;hexEncStr, hexKeyStr, hexIvStr&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> AesEncrypt = <span class="function">(<span class="params">str = <span class="built_in">String</span>, hexKeyStr = <span class="string">''</span>, hexIvStr = <span class="string">''</span>, keyLen = <span class="number">16</span>, ivLen = <span class="number">16</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 解析密钥和偏移</span></span><br><span class="line">    <span class="keyword">var</span> key, iv;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密钥</span></span><br><span class="line">    <span class="keyword">if</span> (hexKeyStr.length !== <span class="number">0</span>) &#123;</span><br><span class="line">        keyLen = hexKeyStr.length / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keyLen !== <span class="number">8</span> &amp;&amp; keyLen !== <span class="number">16</span> &amp;&amp; keyLen !== <span class="number">32</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">'密钥长度不符合要求: '</span> + keyLen;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hexKeyStr.length === <span class="number">0</span>) &#123;</span><br><span class="line">        hexKeyStr = randomHexStr(keyLen * <span class="number">2</span>);</span><br><span class="line">        key = CryptoJS.enc.Hex.parse(hexKeyStr);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        key = CryptoJS.enc.Hex.parse(hexKeyStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 偏移量</span></span><br><span class="line">    <span class="keyword">if</span> (hexIvStr.length !== <span class="number">0</span>) &#123;</span><br><span class="line">        ivLen = hexIvStr.length / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ivLen !== <span class="number">8</span> &amp;&amp; ivLen !== <span class="number">16</span> &amp;&amp; ivLen !== <span class="number">32</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">'偏移量长度不符合要求: '</span> + ivLen;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hexIvStr.length === <span class="number">0</span>) &#123;</span><br><span class="line">        hexIvStr = randomHexStr(ivLen * <span class="number">2</span>);</span><br><span class="line">        iv = CryptoJS.enc.Hex.parse(hexIvStr);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        iv = CryptoJS.enc.Hex.parse(hexIvStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加密</span></span><br><span class="line">    <span class="keyword">const</span> enc = CryptoJS.AES.encrypt(str, key, &#123;</span><br><span class="line">        iv,</span><br><span class="line">        mode: CryptoJS.mode.CBC,</span><br><span class="line">        padding: CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        hexEncStr: enc.ciphertext.toString(),</span><br><span class="line">        hexKeyStr,</span><br><span class="line">        hexIvStr</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-AES-解密"><a href="#3-AES-解密" class="headerlink" title="3. AES 解密"></a>3. AES 解密</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Aes 解密</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>encHexStr 16进制字符串: 密文</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>keyHexStr 16进制字符串: 密钥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>ivHexStr 16进制字符串: 偏移量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>解密后的字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> AesDecrypt = <span class="function">(<span class="params">encHexStr = <span class="built_in">String</span>, keyHexStr = <span class="built_in">String</span>, ivHexStr = <span class="built_in">String</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 解析密钥和偏移</span></span><br><span class="line">    <span class="keyword">const</span> key = CryptoJS.enc.Hex.parse(keyHexStr);</span><br><span class="line">    <span class="keyword">const</span> iv = CryptoJS.enc.Hex.parse(ivHexStr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解密</span></span><br><span class="line">    <span class="keyword">const</span> dec = CryptoJS.AES.decrypt(CryptoJS.enc.Base64.stringify(CryptoJS.enc.Hex.parse(encHexStr)), key, &#123;</span><br><span class="line">        iv,</span><br><span class="line">        mode: CryptoJS.mode.CBC,</span><br><span class="line">        padding: CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dec.toString(CryptoJS.enc.Utf8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用结果-1"><a href="#调用结果-1" class="headerlink" title="调用结果"></a>调用结果</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="string">'AES CBC Encrtypt, Test, Hello World!!!!!'</span>;</span><br><span class="line">    <span class="keyword">const</span> aesResults = AesEncrypt(str);</span><br><span class="line">    <span class="keyword">const</span> encStr = aesResults.hexEncStr;</span><br><span class="line">    <span class="keyword">const</span> key = aesResults.hexKeyStr;</span><br><span class="line">    <span class="keyword">const</span> iv = aesResults.hexIvStr;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'encStr: %s'</span>, encStr);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'key: %s'</span>, key);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'iv: %s'</span>, iv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decStr = AesDecrypt(encStr, key, iv);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'decStr: %s'</span>, decStr);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">encStr: 3aed669123c8be163a8ed89602d86e49683828fd860aa73c21aeae6905695c1bba2bfd7205531768c2d66b4f3e9e527f</span><br><span class="line">key: fffbd3050f001baf4c0e21097ff704ad</span><br><span class="line">iv: 6e4fa052041e7faa1e606a6ef56ab34b</span><br><span class="line">decStr: AES CBC Encrtypt, Test, Hello World!!!!!</span><br></pre></td></tr></table></figure>
<h2 id="C-实现的RSA加密解密函数"><a href="#C-实现的RSA加密解密函数" class="headerlink" title="C++实现的RSA加密解密函数"></a>C++实现的RSA加密解密函数</h2><p>相应的RSA函数、Base64编码解码函数需要引入以下头文件：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/rsa.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cryptopp/base64.h&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="1-生成RSA密钥对"><a href="#1-生成RSA密钥对" class="headerlink" title="1. 生成RSA密钥对"></a>1. 生成RSA密钥对</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 生成RSA密钥对</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">GenerateRSAKey</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span>* pubKeyStr, <span class="built_in">std</span>::<span class="built_in">string</span>* prvKeyStr, <span class="keyword">unsigned</span> <span class="keyword">int</span> keyLen = <span class="number">2048</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pubKeyStr || !prvKeyStr)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"Null Pointer"</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 使用随机数初始化不可逆函数</span></span><br><span class="line">		AutoSeededRandomPool rng;</span><br><span class="line">		InvertibleRSAFunction params;</span><br><span class="line">		params.GenerateRandomWithKeySize(rng, keyLen);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 生成随机密钥对</span></span><br><span class="line">		<span class="function">RSA::PublicKey <span class="title">pubKey</span><span class="params">(params)</span></span>;</span><br><span class="line">		<span class="function">RSA::PrivateKey <span class="title">prvKey</span><span class="params">(params)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 进行Base64编码</span></span><br><span class="line">		<span class="function">Base64Encoder <span class="title">pubeEncoder</span><span class="params">(<span class="keyword">new</span> StringSink(*pubKeyStr))</span></span>;</span><br><span class="line">		pubKey.DEREncode(pubeEncoder);</span><br><span class="line">		pubeEncoder.MessageEnd();</span><br><span class="line"></span><br><span class="line">		<span class="function">Base64Encoder <span class="title">prveEncoder</span><span class="params">(<span class="keyword">new</span> StringSink(*prvKeyStr))</span></span>;</span><br><span class="line">		prvKey.DEREncode(prveEncoder);</span><br><span class="line">		prveEncoder.MessageEnd();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> pubKey, prvKey;</span><br><span class="line">GenerateRSAKey(&amp;pubKey, &amp;prvKey, <span class="number">2048</span>);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"pubKey: \n"</span> &lt;&lt; pubKey &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"prvKey: \n"</span> &lt;&lt; prvKey &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>
<p>输出是一串带有换行符<code>\n</code>的字符串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">pubKey:</span><br><span class="line">MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAqsx9tnvD&#x2F;801PJoUX&#x2F;DV3Vk7cXL7</span><br><span class="line">F3WuSeSGkYyw69dyLJvjb1PYwBOAt3+oKrGsaqclFRhq0iqQaHWRL&#x2F;TVdBM74DWM0wLAu1zU</span><br><span class="line">Mfwql1qpqN2qoFfYS0ETRnsECqiVy1FDDhHvI5vhwJbUCfWDHIa1CPZKCDvbIc3pGYr&#x2F;k3Yq</span><br><span class="line">d4Hh8bdFEpzI47P&#x2F;aIXJm0sF1&#x2F;WugCqAxvC2qO04XoWxMPfbcz&#x2F;OtNbYHAfBange+HV6RVLh</span><br><span class="line">7WMYv7hYO5WLQnfldgkNEAOsX9rYfO9G3EBSDeAyQipkePDPuX6kDvhT&#x2F;kC23tbFKMVoKTIb</span><br><span class="line">2RWXn8YmYjavkXHPbWXICZFWewIBEQ&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">prvKey:</span><br><span class="line">MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCqzH22e8P&#x2F;zTU8mhRf8NXd</span><br><span class="line">WTtxcvsXda5J5IaRjLDr13Ism+NvU9jAE4C3f6gqsaxqpyUVGGrSKpBodZEv9NV0EzvgNYzT</span><br><span class="line">AsC7XNQx&#x2F;CqXWqmo3aqgV9hLQRNGewQKqJXLUUMOEe8jm+HAltQJ9YMchrUI9koIO9shzekZ</span><br><span class="line">iv+Tdip3geHxt0USnMjjs&#x2F;9ohcmbSwXX9a6AKoDG8Lao7ThehbEw99tzP8601tgcB8FqeB74</span><br><span class="line">dXpFUuHtYxi&#x2F;uFg7lYtCd+V2CQ0QA6xf2th870bcQFIN4DJCKmR48M+5fqQO+FP+QLbe1sUo</span><br><span class="line">xWgpMhvZFZefxiZiNq+Rcc9tZcgJkVZ7AgERAoIBAEZUM8OcX8Ou2a+KvRhyOfG7VLY+Z2QD</span><br><span class="line">R8QSzf+yZvezEOUxIWoTd14mJfE0kIoM7KRi8SbN0aHVSoVdliLOOcZiRdTKwYQQMT4XKjKz</span><br><span class="line">IJis3HK1oJxgaB78rZV98pr6H4&#x2F;0SMmO6f+aiiIf&#x2F;PUKvYQ3d7hlaccntJVy54L8&#x2F;9NOGVEX</span><br><span class="line">X&#x2F;kTCA5yJ+cbrbATL4Eq5MQPsRDC6vsc+IkUY8ORf01EIisxScZP+JJVHXY1FnzgqspblCU+</span><br><span class="line">9Z+NPZlHUd0&#x2F;nD5&#x2F;cCHT44UYzoUMh6suvqMRuHJHQ7I5GlcyCP8UdGG5hT&#x2F;+WfJHPPNfpDJ7</span><br><span class="line">n7alL9nbMI+GnokIdOmxt9ECgYEAv21N5MXlkoCFBMI8IeoQ4On7G&#x2F;gsbha+NobcTfzOuhct</span><br><span class="line">rC6P5I27lSk6W843o8op+bMnFDIcFTXJG4JHY9XRSqfNCkrXOdfUGhxs2ybfMlXkYoH+W2iz</span><br><span class="line">hg4EpUswrwFVaZU+BnBi37qfW70wKZMOeeVmDxPsGeHroCumd94MrtECgYEA5GnWpmE1w5OU</span><br><span class="line">0PA0pWUhvneembp+kmVJxnCE6IPIZ2xkYiIwNjN6PTxH&#x2F;A8BaFyopYO&#x2F;EHDqrhQBFnDQzIPN</span><br><span class="line">54FZhEpFecF2IJJ64zeD7518sttJFuiAp7oYWCzUcX2Vz8TSbNMKL495Cq8+Pu&#x2F;&#x2F;dUfzfoZa</span><br><span class="line">1pwarj4YfWGwe4sCgYEAqOf5b4FwNfjt1wW8lmUd86FG+o+uu316qJUcvUh6K7oZPZJ+9tdp</span><br><span class="line">R2Cc55fWvbJhRbwxikpVA6ftrtxdG9rHulfTCRTcBdyN+OvnlDFbhsRB&#x2F;JDRX7a8hVepvwYb</span><br><span class="line">5bXh87&#x2F;rbxfexWhufh9mu0WFPmD&#x2F;svN1+LhIYCaD0y1WfCECgYEAoTumk4&#x2F;ptzr&#x2F;ootwdL&#x2F;b</span><br><span class="line">lYGdIThZWEd&#x2F;XuYDdvOchT10CQkS+RVHOkirSIMQDW6VKYoshBN4euDxtXzPn2wY36aZio7H</span><br><span class="line">oT1EUzo4oGNsMKtnFNcGaoYAdmU+XFvhQQ1asMcrH6QHMKGCniFZHV4dvDLJ&#x2F;vVtTDH0tzrk</span><br><span class="line">HET1C+kCgYEAjmr1l&#x2F;Ie6FTuAU1Hm628n8Slyfp121dHScmjz426gKLmG+ckNXlYOoVj&#x2F;F34</span><br><span class="line">UxYdjlq9UG12RwxMrEdaH2hR3j0IBCHbQrXUXZotJS1Yx1pieZ&#x2F;NE4HB5uAqMk6FlaqWXokZ</span><br><span class="line">mvxkXgwCkVXO4fO5Bh3BZY0+kKXbuByu2Wm4Dfs&#x3D;</span><br></pre></td></tr></table></figure>
<h3 id="2-保存和读取RSA密钥对"><a href="#2-保存和读取RSA密钥对" class="headerlink" title="2. 保存和读取RSA密钥对"></a>2. 保存和读取RSA密钥对</h3><p>在CryptoJS的密钥对保存方式中，将RSA密钥保存到.pem文件时，包含了文件内容的收尾信息，例如私钥的保存格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">Base64编码的密钥：xxxxxxx</span><br><span class="line">-----END PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>保存：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 保存私钥到文件</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SaveRSAPrvKey</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> filePath, <span class="built_in">std</span>::<span class="built_in">string</span> prvKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (filePath.empty())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"File Path is empty!"</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="built_in">std</span>::ofstream <span class="title">ofs</span><span class="params">(filePath)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!ofs.is_open())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"File Open Failed! - "</span> + filePath;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ofs &lt;&lt; <span class="string">"-----BEGIN PRIVATE KEY-----\n"</span>;</span><br><span class="line"></span><br><span class="line">		ofs &lt;&lt; prvKey;</span><br><span class="line"></span><br><span class="line">		ofs &lt;&lt; <span class="string">"-----END PRIVATE KEY-----"</span>;</span><br><span class="line"></span><br><span class="line">		ofs.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 保存公钥到文件</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SaveRSAPubKey</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> filePath, <span class="built_in">std</span>::<span class="built_in">string</span> pubKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (filePath.empty())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"File Path is empty!"</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="built_in">std</span>::ofstream <span class="title">ofs</span><span class="params">(filePath)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!ofs.is_open())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"File Open Failed! - "</span> + filePath;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ofs &lt;&lt; <span class="string">"-----BEGIN PUBLIC KEY-----\n"</span>;</span><br><span class="line">		</span><br><span class="line">		ofs &lt;&lt; pubKey;</span><br><span class="line"></span><br><span class="line">		ofs &lt;&lt; <span class="string">"-----END PUBLIC KEY-----"</span>;</span><br><span class="line"></span><br><span class="line">		ofs.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>读取：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 从文件读取RSA私钥</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="filePath"&gt;文件路径&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="prvKey"&gt;读取的私钥字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;是否读取成功&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ReadRSAPrvKey</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> filePath, <span class="built_in">std</span>::<span class="built_in">string</span>* prvKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!prvKey)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"Null Pointer"</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="built_in">std</span>::ifstream <span class="title">ifs</span><span class="params">(filePath)</span></span>;</span><br><span class="line">		<span class="keyword">if</span> (!ifs.is_open())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"File Open Failed! - "</span> + filePath;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> <span class="built_in">line</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 首行</span></span><br><span class="line">		<span class="built_in">std</span>::getline(ifs, <span class="built_in">line</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取密钥</span></span><br><span class="line">		*prvKey = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">while</span> (!ifs.eof())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">std</span>::getline(ifs, <span class="built_in">line</span>);</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">line</span> == <span class="string">"-----END PRIVATE KEY-----"</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			*prvKey += <span class="built_in">line</span> + <span class="string">'\n'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ifs.<span class="built_in">close</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// 从文件读取RSA公钥</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="filePath"&gt;文件路径&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="pubKey"&gt;读取的公钥字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;是否读取成功&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ReadRSAPubKey</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> filePath, <span class="built_in">std</span>::<span class="built_in">string</span>* pubKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pubKey)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"Null Pointer"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="built_in">std</span>::ifstream <span class="title">ifs</span><span class="params">(filePath)</span></span>;</span><br><span class="line">		<span class="keyword">if</span> (!ifs.is_open())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"File Open Failed! - "</span> + filePath;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> <span class="built_in">line</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 首行</span></span><br><span class="line">		<span class="built_in">std</span>::getline(ifs, <span class="built_in">line</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 读取密钥</span></span><br><span class="line">		*pubKey = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">while</span> (!ifs.eof())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">std</span>::getline(ifs, <span class="built_in">line</span>);</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">line</span> == <span class="string">"-----END PUBLIC KEY-----"</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			*pubKey += <span class="built_in">line</span> + <span class="string">'\n'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ifs.<span class="built_in">close</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-RSA加密解密"><a href="#3-RSA加密解密" class="headerlink" title="3. RSA加密解密"></a>3. RSA加密解密</h3><p>加密函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// RSA加密</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="str"&gt;待加密字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="pubKey"&gt;公钥&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="encStr"&gt;加密后的字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;是否加密成功&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">RSAEncrypt</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> str, <span class="built_in">std</span>::<span class="built_in">string</span> pubKey, <span class="built_in">std</span>::<span class="built_in">string</span>* encStr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!encStr)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"Null Pointer"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		AutoSeededRandomPool rng;</span><br><span class="line">		<span class="function">StringSource <span class="title">pubKeySrc</span><span class="params">(pubKey, <span class="literal">true</span>, <span class="keyword">new</span> Base64Decoder)</span></span>;</span><br><span class="line">		<span class="function">RSAES_OAEP_SHA_Encryptor <span class="title">e</span><span class="params">(pubKeySrc)</span></span>;</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">(str, <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">new</span> PK_EncryptorFilter(rng, e,</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">new</span> Base64Encoder(<span class="keyword">new</span> StringSink(*encStr))</span></span></span><br><span class="line"><span class="function"><span class="params">			)</span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解密函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// RSA解密</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="encStr"&gt;待解密字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="prvKey"&gt;私钥&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="str"&gt;解密后的字符串&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;returns&gt;是否解密成功&lt;/returns&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">RSADecrypt</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> encStr, <span class="built_in">std</span>::<span class="built_in">string</span> prvKey, <span class="built_in">std</span>::<span class="built_in">string</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> <span class="keyword">namespace</span> CryptoPP;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!str)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="string">"Null Pointer"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		AutoSeededRandomPool rng;</span><br><span class="line">		<span class="function">StringSource <span class="title">prvKeySrc</span><span class="params">(prvKey, <span class="literal">true</span>, <span class="keyword">new</span> Base64Decoder)</span></span>;</span><br><span class="line">		<span class="function">RSAES_OAEP_SHA_Decryptor <span class="title">d</span><span class="params">(prvKeySrc)</span></span>;</span><br><span class="line">		<span class="function">StringSource <span class="title">s</span><span class="params">(encStr, <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">new</span> Base64Decoder(</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">new</span> PK_DecryptorFilter(rng, d,</span></span></span><br><span class="line"><span class="function"><span class="params">					<span class="keyword">new</span> StringSink(*str)</span></span></span><br><span class="line"><span class="function"><span class="params">				)</span></span></span><br><span class="line"><span class="function"><span class="params">			)</span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用示例"><a href="#调用示例" class="headerlink" title="调用示例"></a>调用示例</h3><p>以下示例演示了从.pem文件中读取密钥对进行RSA加密解密的过程：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///*</span></span><br><span class="line"><span class="comment">//* RSA加密解密</span></span><br><span class="line"><span class="comment">//* 需要读取文件: 公钥.pem, 私钥.pem</span></span><br><span class="line"><span class="comment">//* 公钥 + 明文字符串 --&gt; 密文</span></span><br><span class="line"><span class="comment">//* 私钥 + 密文字符串 --&gt; 明文</span></span><br><span class="line"><span class="comment">//*/</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> pubKey;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> prvKey;</span><br><span class="line"></span><br><span class="line">ReadRSAPubKey(<span class="string">"./test_pub.pem"</span>, &amp;pubKey);</span><br><span class="line">ReadRSAPrvKey(<span class="string">"./test_prv.pem"</span>, &amp;prvKey);</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; pubKey &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; prvKey &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> str = <span class="string">"Test RSA Encrypt, Hello World"</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> encStr;</span><br><span class="line">RSAEncrypt(str, pubKey, &amp;encStr);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; encStr &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> decStr;</span><br><span class="line">RSADecrypt(encStr, prvKey, &amp;decStr);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; decStr &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">公钥：</span><br><span class="line">MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAqZI1MFbpgioFmCGeITRcFuoEP0n3</span><br><span class="line">UA&#x2F;lSxxZKwSFQCS9eguEQIxVs05njeI4Fhoy5Ch6SWz8jvQZtXZa9qtmJqNUFnssJAPVmW&#x2F;1</span><br><span class="line">yXtr444KdOsFXdhC8sWc9MVVUYgcuyMIBrtWNfLOr5yPnbLd6mW7mDKJW2eN8WQWxW+6Q8sI</span><br><span class="line">2hHU2A8iCvfewFbk8B6mkQTBDdd9jlhBJYFHuiYaxikHUiz4lVyIjOfmdayXgcoSzmuK3+oD</span><br><span class="line">xBVLeIFfBmWFN7O6HRQCthA1T9O7v1Q&#x2F;0lp321Ml1o7fovw6wYnhYiWzjHdO1QrH4RgepXV3</span><br><span class="line">SpH05yySYUQkSWun9tXrF2lTBwIBEQ&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">私钥：</span><br><span class="line">MIIEuwIBADANBgkqhkiG9w0BAQEFAASCBKUwggShAgEAAoIBAQCpkjUwVumCKgWYIZ4hNFwW</span><br><span class="line">6gQ&#x2F;SfdQD+VLHFkrBIVAJL16C4RAjFWzTmeN4jgWGjLkKHpJbPyO9Bm1dlr2q2Ymo1QWeywk</span><br><span class="line">A9WZb&#x2F;XJe2vjjgp06wVd2ELyxZz0xVVRiBy7IwgGu1Y18s6vnI+dst3qZbuYMolbZ43xZBbF</span><br><span class="line">b7pDywjaEdTYDyIK997AVuTwHqaRBMEN132OWEElgUe6JhrGKQdSLPiVXIiM5+Z1rJeByhLO</span><br><span class="line">a4rf6gPEFUt4gV8GZYU3s7odFAK2EDVP07u&#x2F;VD&#x2F;SWnfbUyXWjt+i&#x2F;DrBieFiJbOMd07VCsfh</span><br><span class="line">GB6ldXdKkfTnLJJhRCRJa6f21esXaVMHAgERAoIBABjv2qU59Sm64rR9ahPxHJn1PNwhdzFr</span><br><span class="line">v9ZW&#x2F;g3bBIlu0JHyooH2hRLW0v5G6iFeNKkVAuyuJSQU1pqvhdj7Fo02IvQ&#x2F;SkGIF+HbwkNG</span><br><span class="line">2yj+TNT1YqvrGOd3aefCqqobi8EqzHl15wfvAEcAb3kSxkgeBP&#x2F;LMlE04CsHMIZyUBkHB7gX</span><br><span class="line">yqyDrkWtoxLgyDTuptbwNqFzB7ZHXIL6gKDY3QJWDQHgiC0Nd6bGHUATgY5s+07auUqXsaN1</span><br><span class="line">xdpu7RLF3PpKpiq12R7gpKHJKkcYEyM4ZVJyVFyAQnTHXBNpUuxf5BlcGxj1fA09HspTdqlM</span><br><span class="line">X+1EtVNYOhsIGonfXQwoiakCgYEAxssVdJ+DfkPVMUnlZ2p1yeaL+CNM8adS+O2wQ8ZFCKmy</span><br><span class="line">2J8HXU7g7PdE9r8&#x2F;WWbNn4lzAQIR0E1lmr4KQ+kx3nN2PTdy1&#x2F;1KW8gXYPd&#x2F;hRQrFWxH+O61</span><br><span class="line">0ZCHG5tavR4J8oIhr71HKr8lAq0ossx535auuE8SiAMAeUHAPDbia28CgYEA2l5al6NynFO5</span><br><span class="line">JVx4+OqFOvTkIjpJJEK5n&#x2F;BczHrrMz&#x2F;GowzIY625oSeS9ZxPAFJ9xl&#x2F;2BEkD4ev1PCBRm9C+</span><br><span class="line">+1F1EvZmMxoBeghkbn390jUWSws07z+kFvhcrQiWI5ZcfsRJs6E+UZS55DIVNzIQvDZEPEHZ</span><br><span class="line">qsHNrXHznI3ZpekCgYBpPlanJ0WdMvhlY1tU3gIfmCv71nQHdrN0uhIFw1G5SsgYVDETR+B9</span><br><span class="line">c9k3VjCYvfRjhQCmLkWqg1Pogroj8+05iGvGDkvbwlSK8XXJ7HCv3YA4hJ6S2LqcH1aWJRHr</span><br><span class="line">pn28nz8Cr4AHkl7jTJ0TXTF2XtT4KdyiW&#x2F;ExIs8u7+FH7wKBgQCaJHwuzbpQOxlHjJGgpYs4</span><br><span class="line">rN1FVlG&#x2F;PiitIiNjKZb2&#x2F;9eCJyQKIEbMG+9D9d1po6QTjwgDBl0X8dpIj0iqOP9H&#x2F;UOU6ioF</span><br><span class="line">9D1HFPuZSeBYJXkl6csDO&#x2F;tbgiNM9wCRl1BZe39Rnv7QLL9z5x4I2AvQJk5IpvQAEFTy5wZQ</span><br><span class="line">ZCEp0QKBgA5a&#x2F;PIYaKQo3n2qw5jdRI34HLy7Bhpmt2pHMVfcnou&#x2F;TIZpbyCqSJcqFRorrOvn</span><br><span class="line">i9EhWenM0b4wStuD4KRYByG91N7oZwRKuexIXmzz2YbpImvrfTFbT52wIV5k9jVcgodCDK7N</span><br><span class="line">DekQzQSgu1PFgQitYO+&#x2F;vaa0DNkKR7yLLguX</span><br><span class="line"></span><br><span class="line">密文：</span><br><span class="line">GqvUMa1RpFa5+bgXzXOeor1NkRvYSg776jK9Gq5Foe38sePak9OQEXljUMKxCipjABs6EP+y</span><br><span class="line">AVhxYhYUl&#x2F;P3xvihponjjDY2U+Fy&#x2F;JJhGCHjAhzcpfl04a7xQY9C2dPbt41TXXZ4sIYh2k18</span><br><span class="line">X9bvjeQmdtq9x+gQvK4zW0OZn9IBBiKSnbJ2C+N1T&#x2F;f3YczL4UagjIVNKjGQ6vYhVLBhPAH+</span><br><span class="line">N02bNvknfL&#x2F;ll+2YNNtuviQpUhIQwlbYOkquQjjzC6JJ8SxOGDogfrO2LQ5V4qENFdqRTa9m</span><br><span class="line">CSRdc4BQbNw7EY6if&#x2F;EobRTDu&#x2F;1qBsR&#x2F;f1xBmKfBKiZXA9CXwIkJIw&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">明文：</span><br><span class="line">Test RSA Encrypt, Hello World</span><br></pre></td></tr></table></figure>
<h2 id="JS实现的RSA加密解密函数"><a href="#JS实现的RSA加密解密函数" class="headerlink" title="JS实现的RSA加密解密函数"></a>JS实现的RSA加密解密函数</h2><p>与本文之前章节的借助<code>Node-RSA</code>实现的RSA加密解密方式一至，唯一需要修改的地方在于读取的密钥模式，从<code>pkcs1</code>改为<code>pkcs1_oaep</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> NodeRSA = <span class="built_in">require</span>(<span class="string">'node-rsa'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keyDir = path.join(__dirname, <span class="string">'rsa'</span>);</span><br><span class="line">    <span class="keyword">const</span> pubKey = <span class="keyword">new</span> NodeRSA(fs.readFileSync(path.join(keyDir, <span class="string">'test_pub.pem'</span>)),</span><br><span class="line">        <span class="string">'pkcs8-public-pem'</span>, &#123; <span class="attr">encryptionScheme</span>: <span class="string">'pkcs1_oaep'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> prvKey = <span class="keyword">new</span> NodeRSA(fs.readFileSync(path.join(keyDir, <span class="string">'test_prv.pem'</span>)),</span><br><span class="line">        <span class="string">'pkcs8-private-pem'</span>, &#123; <span class="attr">encryptionScheme</span>: <span class="string">'pkcs1_oaep'</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> msg = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        text: <span class="string">'Hello World'</span>,</span><br><span class="line">        time: <span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'公钥:\n%s\n'</span>, pubKey.exportKey(<span class="string">'pkcs8-public-pem'</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'私钥:\n%s\n'</span>, prvKey.exportKey(<span class="string">'pkcs8-private-pem'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> encMsg = pubKey.encrypt(msg, <span class="string">'base64'</span>, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'密文:\n%s\n'</span>, encMsg);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decMsg = prvKey.decrypt(encMsg, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'明文:\n%s\n'</span>, decMsg);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">公钥:</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAqZI1MFbpgioFmCGeITRc</span><br><span class="line">FuoEP0n3UA&#x2F;lSxxZKwSFQCS9eguEQIxVs05njeI4Fhoy5Ch6SWz8jvQZtXZa9qtm</span><br><span class="line">JqNUFnssJAPVmW&#x2F;1yXtr444KdOsFXdhC8sWc9MVVUYgcuyMIBrtWNfLOr5yPnbLd</span><br><span class="line">6mW7mDKJW2eN8WQWxW+6Q8sI2hHU2A8iCvfewFbk8B6mkQTBDdd9jlhBJYFHuiYa</span><br><span class="line">xikHUiz4lVyIjOfmdayXgcoSzmuK3+oDxBVLeIFfBmWFN7O6HRQCthA1T9O7v1Q&#x2F;</span><br><span class="line">0lp321Ml1o7fovw6wYnhYiWzjHdO1QrH4RgepXV3SpH05yySYUQkSWun9tXrF2lT</span><br><span class="line">BwIBEQ&#x3D;&#x3D;</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line"></span><br><span class="line">私钥:</span><br><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">MIIEuwIBADANBgkqhkiG9w0BAQEFAASCBKUwggShAgEAAoIBAQCpkjUwVumCKgWY</span><br><span class="line">IZ4hNFwW6gQ&#x2F;SfdQD+VLHFkrBIVAJL16C4RAjFWzTmeN4jgWGjLkKHpJbPyO9Bm1</span><br><span class="line">dlr2q2Ymo1QWeywkA9WZb&#x2F;XJe2vjjgp06wVd2ELyxZz0xVVRiBy7IwgGu1Y18s6v</span><br><span class="line">nI+dst3qZbuYMolbZ43xZBbFb7pDywjaEdTYDyIK997AVuTwHqaRBMEN132OWEEl</span><br><span class="line">gUe6JhrGKQdSLPiVXIiM5+Z1rJeByhLOa4rf6gPEFUt4gV8GZYU3s7odFAK2EDVP</span><br><span class="line">07u&#x2F;VD&#x2F;SWnfbUyXWjt+i&#x2F;DrBieFiJbOMd07VCsfhGB6ldXdKkfTnLJJhRCRJa6f2</span><br><span class="line">1esXaVMHAgERAoIBABjv2qU59Sm64rR9ahPxHJn1PNwhdzFrv9ZW&#x2F;g3bBIlu0JHy</span><br><span class="line">ooH2hRLW0v5G6iFeNKkVAuyuJSQU1pqvhdj7Fo02IvQ&#x2F;SkGIF+HbwkNG2yj+TNT1</span><br><span class="line">YqvrGOd3aefCqqobi8EqzHl15wfvAEcAb3kSxkgeBP&#x2F;LMlE04CsHMIZyUBkHB7gX</span><br><span class="line">yqyDrkWtoxLgyDTuptbwNqFzB7ZHXIL6gKDY3QJWDQHgiC0Nd6bGHUATgY5s+07a</span><br><span class="line">uUqXsaN1xdpu7RLF3PpKpiq12R7gpKHJKkcYEyM4ZVJyVFyAQnTHXBNpUuxf5Blc</span><br><span class="line">Gxj1fA09HspTdqlMX+1EtVNYOhsIGonfXQwoiakCgYEAxssVdJ+DfkPVMUnlZ2p1</span><br><span class="line">yeaL+CNM8adS+O2wQ8ZFCKmy2J8HXU7g7PdE9r8&#x2F;WWbNn4lzAQIR0E1lmr4KQ+kx</span><br><span class="line">3nN2PTdy1&#x2F;1KW8gXYPd&#x2F;hRQrFWxH+O610ZCHG5tavR4J8oIhr71HKr8lAq0ossx5</span><br><span class="line">35auuE8SiAMAeUHAPDbia28CgYEA2l5al6NynFO5JVx4+OqFOvTkIjpJJEK5n&#x2F;Bc</span><br><span class="line">zHrrMz&#x2F;GowzIY625oSeS9ZxPAFJ9xl&#x2F;2BEkD4ev1PCBRm9C++1F1EvZmMxoBeghk</span><br><span class="line">bn390jUWSws07z+kFvhcrQiWI5ZcfsRJs6E+UZS55DIVNzIQvDZEPEHZqsHNrXHz</span><br><span class="line">nI3ZpekCgYBpPlanJ0WdMvhlY1tU3gIfmCv71nQHdrN0uhIFw1G5SsgYVDETR+B9</span><br><span class="line">c9k3VjCYvfRjhQCmLkWqg1Pogroj8+05iGvGDkvbwlSK8XXJ7HCv3YA4hJ6S2Lqc</span><br><span class="line">H1aWJRHrpn28nz8Cr4AHkl7jTJ0TXTF2XtT4KdyiW&#x2F;ExIs8u7+FH7wKBgQCaJHwu</span><br><span class="line">zbpQOxlHjJGgpYs4rN1FVlG&#x2F;PiitIiNjKZb2&#x2F;9eCJyQKIEbMG+9D9d1po6QTjwgD</span><br><span class="line">Bl0X8dpIj0iqOP9H&#x2F;UOU6ioF9D1HFPuZSeBYJXkl6csDO&#x2F;tbgiNM9wCRl1BZe39R</span><br><span class="line">nv7QLL9z5x4I2AvQJk5IpvQAEFTy5wZQZCEp0QKBgA5a&#x2F;PIYaKQo3n2qw5jdRI34</span><br><span class="line">HLy7Bhpmt2pHMVfcnou&#x2F;TIZpbyCqSJcqFRorrOvni9EhWenM0b4wStuD4KRYByG9</span><br><span class="line">1N7oZwRKuexIXmzz2YbpImvrfTFbT52wIV5k9jVcgodCDK7NDekQzQSgu1PFgQit</span><br><span class="line">YO+&#x2F;vaa0DNkKR7yLLguX</span><br><span class="line">-----END PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">密文:</span><br><span class="line">ZTONK6mHtgVEDjFB9mIOqg+pxEfNgpeJQuH5I0gVVP1OkUaL37VKTA26UcIVakphcVa3Ju5fD0TpaEFpZRsWrxuGIM8Umrbc7fI1Y2Pie3O&#x2F;EhlF51DRqKxEL5LZKbVqulCw1kI6rtxQlWsogeOwIVHY2vTsGQAjAJB1nZUQNZEfelnSRZxs+OU8VlRgn3hWAua5wtPrCM48eq+Mfo1X&#x2F;EuzD8EFAAtqHEsYQzz6UJl+LPZCw0vGk7flJ3HffMFhXmezCEQbKWeE6B9eyaSP9qFDiZGAu8AoCBWyNJeMIZ9cmbNG1yPCEyciICUUCvqw2Av05VMmJSpQkmoehrZuOw&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">明文:</span><br><span class="line">&#123;&quot;text&quot;:&quot;Hello World&quot;,&quot;time&quot;:1624011798408&#125;</span><br></pre></td></tr></table></figure>
<p>C++实现的</p>
<h1 id="C-与JS的配合使用的AES-RSA双重加密"><a href="#C-与JS的配合使用的AES-RSA双重加密" class="headerlink" title="C++与JS的配合使用的AES+RSA双重加密"></a>C++与JS的配合使用的AES+RSA双重加密</h1><p>AES+RSA的双重加密思路为：随机生成AES的密钥key和偏移iv，使用该密钥+偏移对数据进行加密，得到密文1，接着使用RSA算法对包含AES密钥key和偏移iv的json字符串进行加密，得到密文2；传输两串密文，接收方收到这两串密文后，首先通过RSA解密算法解出AES密钥和偏移，接着再解出数据的明文。</p>
<h2 id="加密说明示例"><a href="#加密说明示例" class="headerlink" title="加密说明示例"></a>加密说明示例</h2><p>原始数据（JSON格式）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"account"</span>: <span class="string">"test"</span>,</span><br><span class="line">	<span class="attr">"password"</span>: <span class="string">"123456"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随机生成的AES密钥和偏移，用JSON格式保存：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"key"</span>: <span class="string">"D8BB5D728B2C96A77AFA7519D060BE57"</span>,</span><br><span class="line">    <span class="attr">"iv"</span>: <span class="string">"170A9B9576B1ECAEE13583C784D6139B"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将原始数据和AES密钥和偏移的JSON转为字符串后，经AES+RSA双重加密，得到加密后的数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"key"</span>: <span class="string">"mM5/dq8hd2ekOHPHT48yrcAJrw3Z4aMAwdmifDeVYbK2xfy53cRm5tJISq5jnN6xDX5SvwrDKCy3QB9qGW0C1wzp/ou5SuJ3/4Rumd2ZdEs9KbmnN/Atcm1oksi5TfmGnqlbnwKN2Z98saZ46DBdiH4pGC2Us9m2MqNTlHXgbQuU56SAjvM7seN/RCwFxjPkAOCjvMIKcq7O2TOhABWSt6GIypvT2PkwopavfmNO3J+5G4dQgNNiCeRM/5uRDEdQcz0GWhF0Fh846rSF9Yt2S5oTww/gxyiMSGOe5fuxaBGEvEhOzEhF6UqHo9lR1qHidSjNJbVQWKpadcKu5VLVuw=="</span>,</span><br><span class="line">    <span class="attr">"params"</span>: <span class="string">"C596AF0D135693FF66B515161710158100B55434E7CDD62C7696BABAA7C5F68774AD6C839551FA00F5353C9DCD6F47CE0814D34658215E1BCA4C40D778E136A5"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解密时，先用RSA私钥从<code>key</code>中解出AES密钥和偏移，接着用AES算法从<code>params</code>中解出原始数据。</p>
<h2 id="纯C-实现"><a href="#纯C-实现" class="headerlink" title="纯C++实现"></a>纯C++实现</h2><p>用到了<code>boost</code>存放JSON数据，头文件、预定义和工具函数如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/property_tree/ptree.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/property_tree/json_parser.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> boost::property_tree::ptree JsonData;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(JsonData json, <span class="built_in">std</span>::<span class="built_in">string</span> title = <span class="string">""</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</span><br><span class="line">		boost::property_tree::write_json(ss, json);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (title.<span class="built_in">size</span>() &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; title &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ss.str() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加密函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">AES_RSA_Encrypt</span><span class="params">(JsonData data, JsonData* encData, <span class="built_in">std</span>::<span class="built_in">string</span> rsaPubKeyPath = <span class="string">"./test_pub.pem"</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!encData) <span class="keyword">throw</span> <span class="string">"输出指针为空"</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 转为字符串</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> jsonStr;</span><br><span class="line">		boost::property_tree::write_json(ss, data);</span><br><span class="line">		jsonStr = ss.str();</span><br><span class="line">		ss.str(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		* AES 加密</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		JsonData aesKey;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> encJsonStr, key, iv;</span><br><span class="line">		<span class="keyword">if</span> (!AesEncrypt(jsonStr, &amp;encJsonStr, &amp;key, &amp;iv)) <span class="keyword">throw</span> <span class="string">"Aes加密失败"</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> aesKeyStr;</span><br><span class="line">		aesKey.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"key"</span>, key);</span><br><span class="line">		aesKey.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"iv"</span>, iv);</span><br><span class="line">		boost::property_tree::write_json(ss, aesKey);</span><br><span class="line">		aesKeyStr = ss.str();</span><br><span class="line">		ss.str(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		* RSA加密</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> encAesKeyStr, pubKey;</span><br><span class="line">		<span class="keyword">if</span> (!ReadRSAPubKey(rsaPubKeyPath, &amp;pubKey)) <span class="keyword">throw</span> <span class="string">"读取RSA公钥失败"</span>;</span><br><span class="line">		<span class="keyword">if</span> (!RSAEncrypt(aesKeyStr, pubKey, &amp;encAesKeyStr)) <span class="keyword">throw</span> <span class="string">"RSA加密失败"</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 覆盖输出内容</span></span><br><span class="line">		encData-&gt;<span class="built_in">clear</span>();</span><br><span class="line">		encData-&gt;<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"params"</span>, encJsonStr);</span><br><span class="line">		encData-&gt;<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"key"</span>, encAesKeyStr);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解密函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">AES_RSA_Decrypt</span><span class="params">(JsonData encData, JsonData* decData, <span class="built_in">std</span>::<span class="built_in">string</span> rsaPrvKeyPath = <span class="string">"./test_prv.pem"</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!decData) <span class="keyword">throw</span> <span class="string">"输出指针为空"</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">using</span> boost::property_tree::read_json;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">stringstream</span> ss;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 解出AES密钥</span></span><br><span class="line">		JsonData aesKey;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> key, iv, aesKeyStr;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> prvKey;</span><br><span class="line">		<span class="keyword">if</span> (!ReadRSAPrvKey(rsaPrvKeyPath, &amp;prvKey)) <span class="keyword">throw</span> <span class="string">"读取RSA密钥失败"</span>;</span><br><span class="line">		<span class="keyword">if</span> (!RSADecrypt(encData.<span class="built_in">get</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"key"</span>), prvKey, &amp;aesKeyStr)) <span class="keyword">throw</span> <span class="string">"RSA解密失败"</span>;</span><br><span class="line">		ss.str(aesKeyStr);</span><br><span class="line">		read_json(ss, aesKey);</span><br><span class="line">		key = aesKey.<span class="built_in">get</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"key"</span>);</span><br><span class="line">		iv = aesKey.<span class="built_in">get</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"iv"</span>);</span><br><span class="line">		ss.str(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// AES解密</span></span><br><span class="line">		decData-&gt;<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> dataStr;</span><br><span class="line">		<span class="keyword">if</span> (!AesDecrypt(encData.<span class="built_in">get</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"params"</span>), key, iv, &amp;dataStr)) <span class="keyword">throw</span> <span class="string">"AES解密失败"</span>;</span><br><span class="line">		ss.str(dataStr);</span><br><span class="line">		read_json(ss, *decData);</span><br><span class="line">		ss.str(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用结果：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// json数据</span></span><br><span class="line">		JsonData json;</span><br><span class="line">		json.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"account"</span>, <span class="string">"test"</span>);</span><br><span class="line">		json.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"password"</span>, <span class="string">"123456"</span>);</span><br><span class="line">		<span class="built_in">print</span>(json, <span class="string">"原始数据："</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 加密</span></span><br><span class="line">		JsonData encJson;</span><br><span class="line">		AES_RSA_Encrypt(json, &amp;encJson, <span class="string">"./test_pub.pem"</span>);</span><br><span class="line">		<span class="built_in">print</span>(encJson, <span class="string">"加密后的数据："</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 解密</span></span><br><span class="line">		JsonData decJson;</span><br><span class="line">		AES_RSA_Decrypt(encJson, &amp;decJson, <span class="string">"./test_prv.pem"</span>);</span><br><span class="line">		<span class="built_in">print</span>(decJson, <span class="string">"解密后的数据："</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">原始数据：</span><br><span class="line">&#123;</span><br><span class="line">    &quot;account&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">加密后的数据：</span><br><span class="line">&#123;</span><br><span class="line">    &quot;params&quot;: &quot;16DCBC4F58148239BCC789C356F8A33CFE9453C91589B4395C9694CCF39D14382BFEC01512686A4796AC8203EE341E1D24CBCD83E2B9247266E3B708DA842909&quot;,</span><br><span class="line">    &quot;key&quot;: &quot;m3c\&#x2F;k\&#x2F;9Rcus1Zg6gJuqaXbtbbUmEp2VIh4cu2J14DIiMRqQdyFQbOEjVyFPt7yVLrNJM+JIL\nR5Jz12dAmrvaEosxn2QLF91E2vXFPb5\&#x2F;jMHbpO4aP6LqfAse6SJWu73eNqBXHfmw4Jjlk8Pp\nGst58hFt8JBEqPqESSMiMH5YAYtxQW2vk08xQO86bxkBwPrUlFnp0VJ\&#x2F;bcyZ2881fP0lus8m\nIppIvnChyyDHK2sUS1pRCBfnKOHayVrLQft6euXnDgXinhtxBIiM90FBEG1lAugnz6+PRpDl\nWXOXv5XdeXsFYTmqC\&#x2F;2L+34L3a4pdM+mjD7zaybUXwhRjAa77IQOpg&#x3D;&#x3D;\n&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">解密后的数据：</span><br><span class="line">&#123;</span><br><span class="line">    &quot;account&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="纯JS实现"><a href="#纯JS实现" class="headerlink" title="纯JS实现"></a>纯JS实现</h2><p>加密和解密函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> encrypt = <span class="function">(<span class="params">json = <span class="built_in">Object</span>, rsaPubKeyPath = <span class="string">'./test_pub.pem'</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// AES加密</span></span><br><span class="line">    <span class="keyword">const</span> aesResults = AesEncrypt(<span class="built_in">JSON</span>.stringify(json));</span><br><span class="line">    <span class="keyword">const</span> key = aesResults.hexKeyStr;</span><br><span class="line">    <span class="keyword">const</span> iv = aesResults.hexIvStr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RSA加密</span></span><br><span class="line">    <span class="keyword">const</span> aesKey = &#123; key, iv &#125;;</span><br><span class="line">    <span class="keyword">const</span> pubKey = <span class="keyword">new</span> NodeRSA(fs.readFileSync(rsaPubKeyPath),</span><br><span class="line">        <span class="string">'pkcs8-public-pem'</span>, &#123; <span class="attr">encryptionScheme</span>: <span class="string">'pkcs1_oaep'</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        params: aesResults.hexEncStr,</span><br><span class="line">        key: pubKey.encrypt(<span class="built_in">JSON</span>.stringify(aesKey), <span class="string">'base64'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> decrypt = <span class="function">(<span class="params">encJson = <span class="built_in">Object</span>, rsaPrvKeyPath = <span class="string">'./test_prv.pem'</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// RSA解密，解出AES密钥偏移</span></span><br><span class="line">    <span class="keyword">const</span> prvKey = <span class="keyword">new</span> NodeRSA(fs.readFileSync(rsaPrvKeyPath),</span><br><span class="line">        <span class="string">'pkcs8-private-pem'</span>, &#123; <span class="attr">encryptionScheme</span>: <span class="string">'pkcs1_oaep'</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> aesKey = <span class="built_in">JSON</span>.parse(prvKey.decrypt(encJson[<span class="string">'key'</span>], <span class="string">'utf8'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AES解密</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(AesDecrypt(encJson[<span class="string">'params'</span>], aesKey[<span class="string">'key'</span>], aesKey[<span class="string">'iv'</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> json = &#123;</span><br><span class="line">        account: <span class="string">'test'</span>,</span><br><span class="line">        password: <span class="string">'123456'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'原始数据：\n'</span>, json);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> encJson = encrypt(json, <span class="string">'./test_pub.pem'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'加密后的数据：\n'</span>, encJson);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decJson = decrypt(encJson, <span class="string">'./test_prv.pem'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'解密后的数据：\n'</span>, decJson);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">原始数据：</span><br><span class="line"> &#123; account: &#39;test&#39;, password: &#39;123456&#39; &#125;</span><br><span class="line">加密后的数据：</span><br><span class="line"> &#123;</span><br><span class="line">  params: &#39;9f1de48b55c4b422f01923fd7e535293a07ddb950615fae7c7563313ba605e7164e67145ecb285ea1ea507d851c9238f&#39;,</span><br><span class="line">  key: &#39;C7ZEIYUcxT2suOAIwNZj+Inof&#x2F;WUFMWPPSrbB29hQ38AkeS44wsfizrvaojAzzN&#x2F;xfyOXt9Slg88p6QmnmlvtIwNtl9ibrDqQJP&#x2F;IGtV7bYImQIGKhm8MjAR6lYohM8dhExB5ht+NUzKXBQYzkjXgipbqOXwk0bu2NNrBfftQ+&#x2F;EJVOsZd5W7Dsf+hhsnSWgZ&#x2F;DusMjRqt0kY1UGKFTgKotBin0bNTpRARCnBdYibrb+JyqiYOQotQgSXfLvdBmJVFs9YvGDZJtfn6zz5yBDkkWY4LDIF7&#x2F;aIukw7qYnK2E17r+sWA018ElofSmOv4yyKe6WKgvU49R5DOaKBUUjpA&#x3D;&#x3D;&#39;</span><br><span class="line">&#125;</span><br><span class="line">解密后的数据：</span><br><span class="line"> &#123; account: &#39;test&#39;, password: &#39;123456&#39; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="C-加密，JS解密"><a href="#C-加密，JS解密" class="headerlink" title="C++加密，JS解密"></a>C++加密，JS解密</h2><p>在C++中，通过如下调用方式进行数据加密：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// json数据</span></span><br><span class="line">		JsonData json;</span><br><span class="line">		json.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"account"</span>, <span class="string">"test"</span>);</span><br><span class="line">		json.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"password"</span>, <span class="string">"123456"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 加密</span></span><br><span class="line">		JsonData encJson;</span><br><span class="line">		AES_RSA_Encrypt(json, &amp;encJson, <span class="string">"./test_pub.pem"</span>);</span><br><span class="line">		<span class="built_in">print</span>(encJson);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"params"</span>: <span class="string">"645588172227F34FBA6C7A6D2D3CB1154046E970D780536E6BCC83B75BC4DFE3D90AD7C2A96CB48E6547AFEC0FA1DD7605DD0A44FAA42FAC8E284E69445F90C6"</span>,</span><br><span class="line">    <span class="attr">"key"</span>: <span class="string">"aRoVwUpqFYyDcCxFfDEmaFQIq3djFKMH\/U0vyb8rJAvKX4hhzVieDcCnsC9icWAaXqMQJKEe\n9Hj7XvSf9bRG68qze5KHW3vNRGS44iAr2hI0Bf+w0SbPceYElnAritlFd2iTtKe5QkdPt9gR\nnV1O7JnWISXDW0CmdTJ\/T3okCo40sRyQnnKhbyv15MaM1xJVaAmBQDxVA0LsiSyM23kPu2bi\nQg9QOISF3zdp8\/QNrrjS66AlgMfBlFB3DUA1+kC8KSQfa4k1X\/SVfoeZLd6LB4OBR0hQbXi\/\n6mQpbXOpTpaCrQkEsrcnCdebWQPcBKtmF0OuuvAKXpmekhYyE9MwKw==\n"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将输出拷贝到JS中解密：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> encJson = &#123;</span><br><span class="line">        <span class="string">"params"</span>: <span class="string">"645588172227F34FBA6C7A6D2D3CB1154046E970D780536E6BCC83B75BC4DFE3D90AD7C2A96CB48E6547AFEC0FA1DD7605DD0A44FAA42FAC8E284E69445F90C6"</span>,</span><br><span class="line">        <span class="string">"key"</span>: <span class="string">"aRoVwUpqFYyDcCxFfDEmaFQIq3djFKMH\/U0vyb8rJAvKX4hhzVieDcCnsC9icWAaXqMQJKEe\n9Hj7XvSf9bRG68qze5KHW3vNRGS44iAr2hI0Bf+w0SbPceYElnAritlFd2iTtKe5QkdPt9gR\nnV1O7JnWISXDW0CmdTJ\/T3okCo40sRyQnnKhbyv15MaM1xJVaAmBQDxVA0LsiSyM23kPu2bi\nQg9QOISF3zdp8\/QNrrjS66AlgMfBlFB3DUA1+kC8KSQfa4k1X\/SVfoeZLd6LB4OBR0hQbXi\/\n6mQpbXOpTpaCrQkEsrcnCdebWQPcBKtmF0OuuvAKXpmekhYyE9MwKw==\n"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> decJson = decrypt(encJson, <span class="string">'./test_prv.pem'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'解密后的数据：\n'</span>, decJson);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到输出：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">解密后的数据：</span><br><span class="line"> &#123; account: 'test', password: '123456' &#125;</span><br></pre></td></tr></table></figure>
<h2 id="JS加密，C-加密"><a href="#JS加密，C-加密" class="headerlink" title="JS加密，C++加密"></a>JS加密，C++加密</h2><p>在JS中加密：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> json = &#123;</span><br><span class="line">        account: <span class="string">'test'</span>,</span><br><span class="line">        password: <span class="string">'123456'</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> encJson = encrypt(json, <span class="string">'./test_pub.pem'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(encJson);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  params: 'a16f83ebb59728f9b0a22fcbac1011c718017cbea832e2abe400e4628ee5562eaf382641a9b9bd8edf09c3ac36106e30',</span><br><span class="line">  key: 'Us2xIrwbB7WgZVMJriP8oAXUFa1UF9cTJPq1pvUHWdJCtkbcYLtRD5WJwTavtmg0Wj1EmzN6awMPmHR0bEdu1Psh8UbgEzZh1+pHQ86kw3DrHn2JhYNbZeucKUwKjqbKIzr/ti7hKRxtVE6PtUn9xZe+BfhgJzqZRAvr12NToXc+vU5DxT5Rp7BhMDasi1V1O/ssNIh3/RIeasfD1tmTtlzGmW3F/+VBAkR1S3eaFpPBtNB77SHYJSZW6GEjJA85HZCYyuQKVRPIxoPPp2vC7LOanxhREMiAebEt877RJ5SuC1UP4jHV46VBBhn7N2N/eh1eeQysyV8+ipM3kzA4Og=='</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拷贝到C++中进行解密：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">try</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 加密</span></span><br><span class="line">		JsonData encJson;</span><br><span class="line">		encJson.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"params"</span>, <span class="string">"a16f83ebb59728f9b0a22fcbac1011c718017cbea832e2abe400e4628ee5562eaf382641a9b9bd8edf09c3ac36106e30"</span>);</span><br><span class="line">		encJson.<span class="built_in">put</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="string">"key"</span>, <span class="string">"Us2xIrwbB7WgZVMJriP8oAXUFa1UF9cTJPq1pvUHWdJCtkbcYLtRD5WJwTavtmg0Wj1EmzN6awMPmHR0bEdu1Psh8UbgEzZh1+pHQ86kw3DrHn2JhYNbZeucKUwKjqbKIzr/ti7hKRxtVE6PtUn9xZe+BfhgJzqZRAvr12NToXc+vU5DxT5Rp7BhMDasi1V1O/ssNIh3/RIeasfD1tmTtlzGmW3F/+VBAkR1S3eaFpPBtNB77SHYJSZW6GEjJA85HZCYyuQKVRPIxoPPp2vC7LOanxhREMiAebEt877RJ5SuC1UP4jHV46VBBhn7N2N/eh1eeQysyV8+ipM3kzA4Og=="</span>);</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// 解密</span></span><br><span class="line">		JsonData decJson;</span><br><span class="line">		AES_RSA_Decrypt(encJson, &amp;decJson, <span class="string">"./test_prv.pem"</span>);</span><br><span class="line">		<span class="built_in">print</span>(decJson, <span class="string">"解密后的数据："</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (<span class="keyword">const</span> <span class="built_in">std</span>::exception&amp; e)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> getchar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解密后的数据：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"account"</span>: <span class="string">"test"</span>,</span><br><span class="line">    <span class="attr">"password"</span>: <span class="string">"123456"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C++</a>
              <a href="/tags/JavaScript/" rel="tag"><i class="fa fa-tag"></i> JavaScript</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/04/%E8%BD%AC%E8%BD%BD-char-const-char-%E5%92%8Cstd-string%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/" rel="prev" title="【转载】char*, const char*和std::string相互转换">
      <i class="fa fa-chevron-left"></i> 【转载】char*, const char*和std::string相互转换
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/07/01/Flex%E5%B8%83%E5%B1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="Flex布局学习笔记">
      Flex布局学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#环境说明"><span class="nav-text">环境说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Node-RSA的安装与使用"><span class="nav-text">Node-RSA的安装与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#生成公钥私钥-pem文件"><span class="nav-text">生成公钥私钥.pem文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#读取-pem文件，RSA加密解密"><span class="nav-text">读取.pem文件，RSA加密解密</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto-js的安装与使用"><span class="nav-text">Crypto.js的安装与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#生成随机的密钥"><span class="nav-text">生成随机的密钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AES加密与解密"><span class="nav-text">AES加密与解密</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto-的编译与使用"><span class="nav-text">Crypto++的编译与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本编译过程"><span class="nav-text">基本编译过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建C-程序引入Crypto-进行测试"><span class="nav-text">创建C++程序引入Crypto++进行测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用动态链接库的方式引入Crypto"><span class="nav-text">使用动态链接库的方式引入Crypto++</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MD还是MT？生成不同运行库的方法"><span class="nav-text">MD还是MT？生成不同运行库的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Crypto-分别完成AES和RSA加密解密"><span class="nav-text">使用Crypto++分别完成AES和RSA加密解密</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#生成RSA公钥私钥对，进行加密解密"><span class="nav-text">生成RSA公钥私钥对，进行加密解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AES加密与解密-1"><span class="nav-text">AES加密与解密</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#C-与JS之间互通的加密和解密函数"><span class="nav-text">C++与JS之间互通的加密和解密函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#C-实现的AES加密解密函数"><span class="nav-text">C++实现的AES加密解密函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-16进制字符串-转-字节数组"><span class="nav-text">1. 16进制字符串 转 字节数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-字节数组-转-16进制字符串"><span class="nav-text">2. 字节数组 转 16进制字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-16进制编码：字符串-转为-16进制字符串"><span class="nav-text">3. 16进制编码：字符串 转为 16进制字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-16进制解码：16进制字符串-转为-字符串"><span class="nav-text">4. 16进制解码：16进制字符串 转为 字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-AES-加密"><span class="nav-text">5. AES 加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-AES-解密"><span class="nav-text">6. AES 解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用结果"><span class="nav-text">调用结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS实现的AES加密解密函数"><span class="nav-text">JS实现的AES加密解密函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-16进制随机字符串生成"><span class="nav-text">1. 16进制随机字符串生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-AES-加密"><span class="nav-text">2. AES 加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-AES-解密"><span class="nav-text">3. AES 解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用结果-1"><span class="nav-text">调用结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-实现的RSA加密解密函数"><span class="nav-text">C++实现的RSA加密解密函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-生成RSA密钥对"><span class="nav-text">1. 生成RSA密钥对</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-保存和读取RSA密钥对"><span class="nav-text">2. 保存和读取RSA密钥对</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-RSA加密解密"><span class="nav-text">3. RSA加密解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用示例"><span class="nav-text">调用示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS实现的RSA加密解密函数"><span class="nav-text">JS实现的RSA加密解密函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#C-与JS的配合使用的AES-RSA双重加密"><span class="nav-text">C++与JS的配合使用的AES+RSA双重加密</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#加密说明示例"><span class="nav-text">加密说明示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#纯C-实现"><span class="nav-text">纯C++实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#纯JS实现"><span class="nav-text">纯JS实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-加密，JS解密"><span class="nav-text">C++加密，JS解密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS加密，C-加密"><span class="nav-text">JS加密，C++加密</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="林杉"
      src="/images/blog/avatar_136x136.png">
  <p class="site-author-name" itemprop="name">林杉</p>
  <div class="site-description" itemprop="description">开发记录 & 思考笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">69</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">林杉</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">379k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:44</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '77edc458d1e975c91584',
      clientSecret: 'd066ea784ad9a8840650ce87154372d890562ecc',
      repo        : 'whuls.github.io',
      owner       : 'WHULS',
      admin       : ['WHULS'],
      id          : '69396cd76218eb18927e209dff3713a9',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
