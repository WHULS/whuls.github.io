<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/blog/03_16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog/03_32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog/03_16x16.png">
  <link rel="mask-icon" href="/images/blog/03_16x16.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"whuls.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="图像浏览软件的下一步进化就是用户交互，而在图像上进行绘图、操作绘制的图形是交互的最简单形式。这篇博客记录了在图像浏览软件中加入用户交互功能的过程，包括图像的缩小放大显示、绘制不同类型的矢量、定位查看和删除矢量等。">
<meta property="og:type" content="article">
<meta property="og:title" content="从1到2：添加绘图、缩放、表格操作等内容">
<meta property="og:url" content="https://whuls.github.io/2021/05/04/%E4%BB%8E1%E5%88%B02-%E6%B7%BB%E5%8A%A0%E7%BB%98%E5%9B%BE-%E7%BC%A9%E6%94%BE-%E8%A1%A8%E6%A0%BC%E6%93%8D%E4%BD%9C%E7%AD%89%E5%86%85%E5%AE%B9/index.html">
<meta property="og:site_name" content="林杉的个人博客">
<meta property="og:description" content="图像浏览软件的下一步进化就是用户交互，而在图像上进行绘图、操作绘制的图形是交互的最简单形式。这篇博客记录了在图像浏览软件中加入用户交互功能的过程，包括图像的缩小放大显示、绘制不同类型的矢量、定位查看和删除矢量等。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://whuls.github.io/images/KvImage-v3.0.gif">
<meta property="article:published_time" content="2021-05-04T15:08:43.000Z">
<meta property="article:modified_time" content="2021-05-04T15:20:26.334Z">
<meta property="article:author" content="林杉">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Qt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://whuls.github.io/images/KvImage-v3.0.gif">

<link rel="canonical" href="https://whuls.github.io/2021/05/04/%E4%BB%8E1%E5%88%B02-%E6%B7%BB%E5%8A%A0%E7%BB%98%E5%9B%BE-%E7%BC%A9%E6%94%BE-%E8%A1%A8%E6%A0%BC%E6%93%8D%E4%BD%9C%E7%AD%89%E5%86%85%E5%AE%B9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>从1到2：添加绘图、缩放、表格操作等内容 | 林杉的个人博客</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5ef394f44970187e7ab7e57f9ffe9a4e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/whuls" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">林杉的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">66</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">24</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">71</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://whuls.github.io/2021/05/04/%E4%BB%8E1%E5%88%B02-%E6%B7%BB%E5%8A%A0%E7%BB%98%E5%9B%BE-%E7%BC%A9%E6%94%BE-%E8%A1%A8%E6%A0%BC%E6%93%8D%E4%BD%9C%E7%AD%89%E5%86%85%E5%AE%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/blog/avatar_136x136.png">
      <meta itemprop="name" content="林杉">
      <meta itemprop="description" content="开发记录 & 思考笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林杉的个人博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          从1到2：添加绘图、缩放、表格操作等内容
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-05-04 23:08:43 / 修改时间：23:20:26" itemprop="dateCreated datePublished" datetime="2021-05-04T23:08:43+08:00">2021-05-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>25k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>23 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ol class="post-body-toc"><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#修改QAction"><span class="post-body-toc-text">修改QAction</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#获取action"><span class="post-body-toc-text">获取action</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#获取-amp-修改文字"><span class="post-body-toc-text">获取&amp;修改文字</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#设置是否可选"><span class="post-body-toc-text">设置是否可选</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#遍历一个QMenu下的所有QAction"><span class="post-body-toc-text">遍历一个QMenu下的所有QAction</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#鼠标滚轮事件"><span class="post-body-toc-text">鼠标滚轮事件</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#判断当前按钮"><span class="post-body-toc-text">判断当前按钮</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#缩放控制"><span class="post-body-toc-text">缩放控制</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#矢量绘图功能"><span class="post-body-toc-text">矢量绘图功能</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#存储绘图图形数据的变量"><span class="post-body-toc-text">存储绘图图形数据的变量</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#类接口：启动和关闭绘图"><span class="post-body-toc-text">类接口：启动和关闭绘图</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#静态函数：在图像上绘制图形"><span class="post-body-toc-text">静态函数：在图像上绘制图形</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#图形绘制后触发的事件"><span class="post-body-toc-text">图形绘制后触发的事件</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#在图像窗口显示带矢量图形的图片"><span class="post-body-toc-text">在图像窗口显示带矢量图形的图片</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#绘图的关键：鼠标事件"><span class="post-body-toc-text">绘图的关键：鼠标事件</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#在父组件响应事件"><span class="post-body-toc-text">在父组件响应事件</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#删除矢量"><span class="post-body-toc-text">删除矢量</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#QTextBrowser滚动到底部"><span class="post-body-toc-text">QTextBrowser滚动到底部</span></a></li><li class="post-body-toc-item post-body-toc-level-1"><a class="post-body-toc-link" href="#矢量窗口"><span class="post-body-toc-text">矢量窗口</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#创建类"><span class="post-body-toc-text">创建类</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#设置窗体类"><span class="post-body-toc-text">设置窗体类</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#使用按钮控件控制窗体最前"><span class="post-body-toc-text">使用按钮控件控制窗体最前</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#使用表格"><span class="post-body-toc-text">使用表格</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#表格初始化"><span class="post-body-toc-text">表格初始化</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#表格内容操作：不同数据显示的初始化，填充，清空，滚动"><span class="post-body-toc-text">表格内容操作：不同数据显示的初始化，填充，清空，滚动</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#表格事件"><span class="post-body-toc-text">表格事件</span></a></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#表格内的操作按钮"><span class="post-body-toc-text">表格内的操作按钮</span></a><ol class="post-body-toc-child"><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#创建按钮"><span class="post-body-toc-text">创建按钮</span></a></li><li class="post-body-toc-item post-body-toc-level-3"><a class="post-body-toc-link" href="#获取行号：使用sender-函数"><span class="post-body-toc-text">获取行号：使用sender()函数</span></a></li></ol></li><li class="post-body-toc-item post-body-toc-level-2"><a class="post-body-toc-link" href="#右键点击操作"><span class="post-body-toc-text">右键点击操作</span></a></li></ol></li></ol>
      
      
        <p><img src="/images/KvImage-v3.0.gif" alt="KvImage-v3.0"></p>
<h1 id="修改QAction"><a href="#修改QAction" class="headerlink" title="修改QAction"></a>修改QAction</h1><p>在代码中控制界面菜单的QAction内容，如替换文字、设置可选、设置样式等。</p>
<h2 id="获取action"><a href="#获取action" class="headerlink" title="获取action"></a>获取action</h2><p>通过<code>ui.[action_name]</code>获取，如：<code>ui.action_open_image</code></p>
<h2 id="获取-amp-修改文字"><a href="#获取-amp-修改文字" class="headerlink" title="获取&amp;修改文字"></a>获取&amp;修改文字</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;ui.action_open_image-&gt;<span class="built_in">text</span>();</span><br><span class="line"><span class="keyword">this</span>-&gt;ui.action_open_image-&gt;setText(QString::fromLocal8Bit(<span class="string">"哈哈哈"</span>));</span><br></pre></td></tr></table></figure>
<h2 id="设置是否可选"><a href="#设置是否可选" class="headerlink" title="设置是否可选"></a>设置是否可选</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;ui.action_open_image-&gt;setEnabled(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h2 id="遍历一个QMenu下的所有QAction"><a href="#遍历一个QMenu下的所有QAction" class="headerlink" title="遍历一个QMenu下的所有QAction"></a>遍历一个QMenu下的所有QAction</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">foreach(QAction * action, <span class="keyword">this</span>-&gt;ui.menu_2-&gt;actions())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (action-&gt;isSeparator()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (action == <span class="keyword">this</span>-&gt;ui.action_draw_point) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    action-&gt;setEnabled(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="鼠标滚轮事件"><a href="#鼠标滚轮事件" class="headerlink" title="鼠标滚轮事件"></a>鼠标滚轮事件</h1><h2 id="判断当前按钮"><a href="#判断当前按钮" class="headerlink" title="判断当前按钮"></a>判断当前按钮</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageViewer::wheelEvent</span><span class="params">(QWheelEvent* evt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 如果当前按下的按钮是鼠标左键</span></span><br><span class="line">    <span class="keyword">if</span> (evt-&gt;buttons() &amp; Qt::LeftButton)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// TODO...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="缩放控制"><a href="#缩放控制" class="headerlink" title="缩放控制"></a>缩放控制</h2><p>应对两种情况：缩放过小和放大过大，进行了两个控制</p>
<ol>
<li>缩小时不允许小于某个窗口比例（例如0.5）。缩小过小时，长宽均小于比例时，按矩形与窗口对应边的比例较大的那个来。例如矩形长比窗口长为0.3，宽之比为0.5，那么以宽为主；否则反之。</li>
<li>放大时显示窗口映射到原图范围不大于某个像素值（例如100像素）。放大过大时，显示区映射到图像上矩形长宽任意一个小于限定值时，需要进行拉伸，保证大于限定值。例如，放大后显示区矩形映射到图像上宽度为90，高度为80，限定值为100，那么要求两个都大于100。调整后显示区高度应该为100，宽度为112.5，保证都大于限定值。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变量</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	QLabel* mLabel;</span><br><span class="line">	cv::Mat mImg;</span><br><span class="line">	cv::Rect mRect;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageViewer::wheelEvent</span><span class="params">(QWheelEvent* evt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 接收事件，不往下传递</span></span><br><span class="line">	evt-&gt;accept();</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImg.data)</span><br><span class="line">	&#123;</span><br><span class="line">		qDebug() &lt;&lt; <span class="string">"angleDelta: "</span> &lt;&lt; evt-&gt;angleDelta().y();  <span class="comment">// angleDelta:  QPoint(0,120)</span></span><br><span class="line"></span><br><span class="line">		QPointF pt = evt-&gt;posF();    <span class="comment">// 鼠标中心点</span></span><br><span class="line">		<span class="keyword">double</span> delta = <span class="number">0.1</span>;          <span class="comment">// 缩放系数</span></span><br><span class="line">		delta *= <span class="keyword">double</span>(evt-&gt;angleDelta().y()) / <span class="number">8</span> / <span class="number">15</span>;  <span class="comment">// 向上滚为正，放大；向下滚为负，缩小</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> winHeight, winWidth;</span><br><span class="line">		cv::Rect nRect;</span><br><span class="line">		<span class="keyword">double</span> imgMinZoomRatio = <span class="number">0.5</span>;         <span class="comment">// 最小缩小到原来的几倍</span></span><br><span class="line">		<span class="keyword">double</span> imgMaxZoomPx = <span class="number">100</span>;            <span class="comment">// 最大放大到多少像素</span></span><br><span class="line">		<span class="keyword">double</span> x0 = pt.x(),   <span class="comment">// 鼠标窗口坐标</span></span><br><span class="line">			y0 = pt.y(),</span><br><span class="line">			x1 = <span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.x),  <span class="comment">// 矩形左上角</span></span><br><span class="line">			y1 = <span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.y);</span><br><span class="line">		winHeight = <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">height</span>();</span><br><span class="line">		winWidth = <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">width</span>();</span><br><span class="line">		<span class="comment">// 先计算目标区域图像矩形</span></span><br><span class="line">		nRect.<span class="built_in">width</span> = cvRound(<span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.<span class="built_in">width</span>) * (<span class="number">1</span> + delta));</span><br><span class="line">		nRect.<span class="built_in">height</span> = cvRound(<span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.<span class="built_in">height</span>) * (<span class="number">1</span> + delta));</span><br><span class="line">		nRect.x = cvRound(x0 + (x1 - x0) * (<span class="number">1</span> + delta));</span><br><span class="line">		nRect.y = cvRound(y0 + (y1 - y0) * (<span class="number">1</span> + delta));</span><br><span class="line">		<span class="comment">// 根据计算结果优化矩形</span></span><br><span class="line">		<span class="comment">// 1. 缩小过小时，长宽均小于比例时，按矩形与窗口对应边的比例较大的那个来。</span></span><br><span class="line">		<span class="comment">// 例如矩形长比窗口长为0.3，宽之比为0.5，那么以宽为主；否则反之。</span></span><br><span class="line">		<span class="keyword">double</span> imgRectWidthZoomRatio = <span class="keyword">double</span>(nRect.<span class="built_in">width</span>) / <span class="keyword">double</span>(winWidth);</span><br><span class="line">		<span class="keyword">double</span> imgRectHeightZoomRatio = <span class="keyword">double</span>(nRect.<span class="built_in">height</span>) / <span class="keyword">double</span>(winHeight);</span><br><span class="line">		<span class="keyword">if</span> (imgRectWidthZoomRatio &lt; imgMinZoomRatio &amp;&amp; imgRectHeightZoomRatio &lt; imgMinZoomRatio)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (imgRectWidthZoomRatio &gt;= imgRectHeightZoomRatio)</span><br><span class="line">			&#123;</span><br><span class="line">				delta = <span class="keyword">double</span>(winWidth) * imgMinZoomRatio / <span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.<span class="built_in">width</span>) - <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> delta = <span class="keyword">double</span>(winHeight) * imgMinZoomRatio / <span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.<span class="built_in">height</span>) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">			nRect.<span class="built_in">width</span> = cvRound(<span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.<span class="built_in">width</span>) * (<span class="number">1</span> + delta));</span><br><span class="line">			nRect.<span class="built_in">height</span> = cvRound(<span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mRect.<span class="built_in">height</span>) * (<span class="number">1</span> + delta));</span><br><span class="line">			nRect.x = winWidth / <span class="number">2</span> - nRect.<span class="built_in">width</span> / <span class="number">2</span>;</span><br><span class="line">			nRect.y = winHeight / <span class="number">2</span> - nRect.<span class="built_in">height</span> / <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 2. 放大过大时，显示区映射到图像上矩形长宽任意一个小于限定值时，需要进行拉伸，保证大于限定值</span></span><br><span class="line">		<span class="comment">// 例如，放大后显示区矩形映射到图像上宽度为90，高度为80，限定值为100，那么要求两个都大于100</span></span><br><span class="line">		<span class="comment">// 调整后显示区高度应该为100，宽度为112.5，保证都大于限定值</span></span><br><span class="line">		<span class="keyword">double</span> imgRectRawImageWidth = <span class="keyword">double</span>(winWidth) / <span class="keyword">double</span>(nRect.<span class="built_in">width</span>) * <span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mImg.cols);</span><br><span class="line">		<span class="keyword">double</span> imgRectRawImageHeight = <span class="keyword">double</span>(winHeight) / <span class="keyword">double</span>(nRect.<span class="built_in">height</span>) * <span class="keyword">double</span>(<span class="keyword">this</span>-&gt;mImg.rows);</span><br><span class="line">		<span class="keyword">if</span> (imgRectRawImageWidth &lt; imgMaxZoomPx || imgRectRawImageHeight &lt; imgMaxZoomPx)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">double</span> zoomRatio;</span><br><span class="line">			<span class="keyword">if</span> (imgRectRawImageWidth &lt;= imgRectRawImageHeight)</span><br><span class="line">			&#123;</span><br><span class="line">				zoomRatio = imgRectRawImageWidth / imgMaxZoomPx;</span><br><span class="line">			&#125; <span class="keyword">else</span> zoomRatio = imgRectRawImageHeight / imgMaxZoomPx;</span><br><span class="line"></span><br><span class="line">			nRect.<span class="built_in">width</span> = <span class="keyword">double</span>(nRect.<span class="built_in">width</span>) * zoomRatio;</span><br><span class="line">			nRect.<span class="built_in">height</span> = <span class="keyword">double</span>(nRect.<span class="built_in">height</span>) * zoomRatio;</span><br><span class="line">			nRect.x = cvRound(x0 + (nRect.x - x0) * (zoomRatio));</span><br><span class="line">			nRect.y = cvRound(y0 + (nRect.y - y0) * (zoomRatio));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mRect == nRect) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;mRect = nRect;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="矢量绘图功能"><a href="#矢量绘图功能" class="headerlink" title="矢量绘图功能"></a>矢量绘图功能</h1><p>针对视图类<code>ImageViewer</code>添加绘图功能。绘图功能包括：画点、画线、画矩形、画旋转矩形等。自由涂鸦暂不考虑。</p>
<h2 id="存储绘图图形数据的变量"><a href="#存储绘图图形数据的变量" class="headerlink" title="存储绘图图形数据的变量"></a>存储绘图图形数据的变量</h2><p>存放在视图类中的几何图形数据主要用来显示，不设计过多的存储机制。</p>
<p>注意这里的<code>mImgStartX</code>等变量专门用来存储鼠标移动的点在图像上的坐标。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> mImgStartX, mImgStartY, mImgEndX, mImgEndY;  <span class="comment">// 用于记录起止点在图像上的坐标</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> isDrawPoint,</span><br><span class="line">    isDrawLine,</span><br><span class="line">    isDrawRectangle,</span><br><span class="line">    isDrawRotateRectangle;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2d&gt; mPts;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4d&gt; mLines;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Rect2d&gt; mRects;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;RotRect2D&gt; mRotRects;</span><br></pre></td></tr></table></figure>
<h2 id="类接口：启动和关闭绘图"><a href="#类接口：启动和关闭绘图" class="headerlink" title="类接口：启动和关闭绘图"></a>类接口：启动和关闭绘图</h2><p>视图类初始化后，通过这两个函数启动关闭其绘图功能。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageViewer::startDrawPoint</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;isDrawing())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;isDrawPoint = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;mPts.<span class="built_in">clear</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageViewer::stopDrawPoint</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;isDrawPoint = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;showImage(<span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="静态函数：在图像上绘制图形"><a href="#静态函数：在图像上绘制图形" class="headerlink" title="静态函数：在图像上绘制图形"></a>静态函数：在图像上绘制图形</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*在img上绘制各种图形*/</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">drawPoint</span><span class="params">(cv::Mat&amp; img, <span class="keyword">const</span> cv::Point2d&amp; pt, <span class="keyword">const</span> cv::Scalar&amp; color = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">const</span> <span class="keyword">double</span> crossLength = <span class="number">10.0</span>, <span class="keyword">const</span> <span class="keyword">double</span> lineWidth = <span class="number">1.0</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">drawLine</span><span class="params">(cv::Mat&amp; img, <span class="keyword">const</span> cv::Vec4d&amp; <span class="built_in">line</span>, <span class="keyword">const</span> cv::Scalar&amp; color = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">const</span> <span class="keyword">double</span> lineWidth = <span class="number">1.0</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">drawRectangle</span><span class="params">(cv::Mat&amp; img, <span class="keyword">const</span> cv::Rect2d&amp; <span class="built_in">rect</span>, <span class="keyword">const</span> cv::Scalar&amp; color = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">const</span> <span class="keyword">double</span> lineWidth = <span class="number">1.0</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">drawRotateRectangle</span><span class="params">(cv::Mat&amp; img, <span class="keyword">const</span> RotRect2D&amp; rotRect, <span class="keyword">const</span> cv::Scalar&amp; color = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">const</span> <span class="keyword">double</span> lineWidth = <span class="number">1.0</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="图形绘制后触发的事件"><a href="#图形绘制后触发的事件" class="headerlink" title="图形绘制后触发的事件"></a>图形绘制后触发的事件</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">signals:</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">drawNewPoint</span><span class="params">(<span class="keyword">const</span> cv::Point2d&amp; pt)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">drawNewLine</span><span class="params">(<span class="keyword">const</span> cv::Vec4d&amp; <span class="built_in">line</span>)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">drawNewRectangle</span><span class="params">(<span class="keyword">const</span> cv::Rect2d&amp; <span class="built_in">rect</span>)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">drawNewRotateRectangle</span><span class="params">(<span class="keyword">const</span> RotRect2D&amp; rotRect)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="在图像窗口显示带矢量图形的图片"><a href="#在图像窗口显示带矢量图形的图片" class="headerlink" title="在图像窗口显示带矢量图形的图片"></a>在图像窗口显示带矢量图形的图片</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*显示带有矢量图形的图片，适量坐标均为图像坐标，绘制后调用showImage()*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showImageWithPoints</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; img, <span class="keyword">const</span> cv::Rect&amp; imgRect, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2d&gt;&amp; pts, <span class="keyword">const</span> cv::Scalar&amp; pointColor = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showImageWithLines</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; img, <span class="keyword">const</span> cv::Rect&amp; imgRect, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Vec4d&gt;&amp; lines, <span class="keyword">const</span> cv::Scalar&amp; lineColor = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showImageWithRectangles</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; img, <span class="keyword">const</span> cv::Rect&amp; imgRect, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Rect2d&gt;&amp; rects, <span class="keyword">const</span> cv::Scalar&amp; lineColor = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showImageWithRotateRectangles</span><span class="params">(<span class="keyword">const</span> cv::Mat&amp; img, <span class="keyword">const</span> cv::Rect&amp; imgRect, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;RotRect2D&gt;&amp; rotRects, <span class="keyword">const</span> cv::Scalar&amp; lineColor = cv::Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="绘图的关键：鼠标事件"><a href="#绘图的关键：鼠标事件" class="headerlink" title="绘图的关键：鼠标事件"></a>绘图的关键：鼠标事件</h2><p>鼠标按下后记录图像坐标（如果在图像内），移动时根据是否在绘图更新鼠标坐标，鼠标抬起时记录绘图结果。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageViewer::mousePressEvent</span><span class="params">(QMouseEvent* evt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 接收事件，不往下传递</span></span><br><span class="line">	evt-&gt;accept();</span><br><span class="line">	QPointF pt = evt-&gt;localPos();</span><br><span class="line">	<span class="keyword">this</span>-&gt;msX = <span class="keyword">this</span>-&gt;meX = pt.x();</span><br><span class="line">	<span class="keyword">this</span>-&gt;msY = <span class="keyword">this</span>-&gt;meY = pt.y();</span><br><span class="line">	qDebug() &lt;&lt; QString(<span class="string">"ImageViewer::mousePressEvent() - (x=%1, y=%2)"</span>)</span><br><span class="line">		.arg(<span class="keyword">this</span>-&gt;msX).arg(<span class="keyword">this</span>-&gt;msY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImg.data &amp;&amp; <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">height</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">width</span>() &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		px p;</span><br><span class="line">		<span class="keyword">if</span> (Calc2D::getPxFromImage(p, cv::Point(<span class="keyword">this</span>-&gt;meX, <span class="keyword">this</span>-&gt;meY), <span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>-&gt;mImgStartX = <span class="keyword">this</span>-&gt;mImgEndX = p.x;</span><br><span class="line">			<span class="keyword">this</span>-&gt;mImgStartY = <span class="keyword">this</span>-&gt;mImgEndY = p.y;</span><br><span class="line">			<span class="function">emit <span class="title">imageMouseMoveEvent</span><span class="params">(p)</span></span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawPoint)</span><br><span class="line">			&#123;</span><br><span class="line">				cv::Mat frame = <span class="keyword">this</span>-&gt;mImg.clone();</span><br><span class="line">				<span class="keyword">this</span>-&gt;drawPoint(frame, cv::Point2d(p.x, p.y));</span><br><span class="line">				<span class="keyword">this</span>-&gt;showImageWithPoints(frame, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mPts);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawLine)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawRectangle)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawRotateRectangle)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> ImageViewer::mouseMoveEvent(QMouseEvent* evt)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 接收事件，不往下传递</span></span><br><span class="line">	evt-&gt;accept();</span><br><span class="line"></span><br><span class="line">	QPointF pt = evt-&gt;localPos();</span><br><span class="line">	<span class="keyword">this</span>-&gt;meX = pt.x();</span><br><span class="line">	<span class="keyword">this</span>-&gt;meY = pt.y();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImg.data &amp;&amp; <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">height</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">width</span>() &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 如果在绘图时取不到像素点，则退出；一般情况下取不到像素点可能是在移动图像</span></span><br><span class="line">		px p;</span><br><span class="line">		<span class="keyword">if</span> (!Calc2D::getPxFromImage(p, cv::Point(<span class="keyword">this</span>-&gt;meX, <span class="keyword">this</span>-&gt;meY), <span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect)</span><br><span class="line">            &amp;&amp; <span class="keyword">this</span>-&gt;isDrawing())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>-&gt;mImgEndX = p.x;</span><br><span class="line">		<span class="keyword">this</span>-&gt;mImgEndY = p.y;</span><br><span class="line">		<span class="function">emit <span class="title">imageMouseMoveEvent</span><span class="params">(p)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 绘图时窗口不变，因此不需要考虑图像矩形位置变化</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawPoint)</span><br><span class="line">		&#123;</span><br><span class="line">			cv::Mat frame = <span class="keyword">this</span>-&gt;mImg.clone();</span><br><span class="line">			<span class="keyword">this</span>-&gt;drawPoint(frame, cv::Point2d(<span class="keyword">this</span>-&gt;mImgEndX, <span class="keyword">this</span>-&gt;mImgEndY));</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithPoints(frame, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mPts);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawLine)</span><br><span class="line">		&#123;</span><br><span class="line">			cv::Mat frame = <span class="keyword">this</span>-&gt;mImg.clone();</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartX - <span class="keyword">this</span>-&gt;mImgEndX) &gt; <span class="number">1e-5</span> || <span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartY - <span class="keyword">this</span>-&gt;mImgEndY) &gt; <span class="number">1e-5</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">this</span>-&gt;drawLine(frame, cv::Vec4d(<span class="keyword">this</span>-&gt;mImgStartX, <span class="keyword">this</span>-&gt;mImgStartY, <span class="keyword">this</span>-&gt;mImgEndX, <span class="keyword">this</span>-&gt;mImgEndY));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithLines(frame, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mLines);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawRectangle)</span><br><span class="line">		&#123;</span><br><span class="line">			cv::Mat frame = <span class="keyword">this</span>-&gt;mImg.clone();</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartX - <span class="keyword">this</span>-&gt;mImgEndX) &gt; <span class="number">1e-5</span> || <span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartY - <span class="keyword">this</span>-&gt;mImgEndY) &gt; <span class="number">1e-5</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">double</span> x1, y1, x2, y2;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImgStartX &lt;= <span class="keyword">this</span>-&gt;mImgEndX)</span><br><span class="line">				&#123;</span><br><span class="line">					x1 = <span class="keyword">this</span>-&gt;mImgStartX;</span><br><span class="line">					x2 = <span class="keyword">this</span>-&gt;mImgEndX;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					x1 = <span class="keyword">this</span>-&gt;mImgEndX;</span><br><span class="line">					x2 = <span class="keyword">this</span>-&gt;mImgStartX;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImgStartY &lt;= <span class="keyword">this</span>-&gt;mImgEndY)</span><br><span class="line">				&#123;</span><br><span class="line">					y1 = <span class="keyword">this</span>-&gt;mImgStartY;</span><br><span class="line">					y2 = <span class="keyword">this</span>-&gt;mImgEndY;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					y1 = <span class="keyword">this</span>-&gt;mImgEndY;</span><br><span class="line">					y2 = <span class="keyword">this</span>-&gt;mImgStartY;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">this</span>-&gt;drawRectangle(frame, cv::Rect2d(x1, y1, x2 - x1, y2 - y1));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithRectangles(frame, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mRects);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawRotateRectangle)</span><br><span class="line">		&#123;</span><br><span class="line">			cv::Mat frame = <span class="keyword">this</span>-&gt;mImg.clone();</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartX - <span class="keyword">this</span>-&gt;mImgEndX) &gt; <span class="number">1e-5</span> || <span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartY - <span class="keyword">this</span>-&gt;mImgEndY) &gt; <span class="number">1e-5</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="function">RotRect2D <span class="title">rotRect</span><span class="params">(cv::Vec4d(<span class="keyword">this</span>-&gt;mImgStartX, <span class="keyword">this</span>-&gt;mImgStartY, <span class="keyword">this</span>-&gt;mImgEndX, <span class="keyword">this</span>-&gt;mImgEndY))</span></span>;</span><br><span class="line">				<span class="keyword">this</span>-&gt;drawRotateRectangle(frame, rotRect);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithRotateRectangles(frame, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mRotRects);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			cv::Rect tRect = <span class="keyword">this</span>-&gt;mRect;</span><br><span class="line">			tRect.x += (<span class="keyword">this</span>-&gt;meX - <span class="keyword">this</span>-&gt;msX);</span><br><span class="line">			tRect.y += (<span class="keyword">this</span>-&gt;meY - <span class="keyword">this</span>-&gt;msY);</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImage(<span class="keyword">this</span>-&gt;mImg, tRect);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageViewer::mouseReleaseEvent</span><span class="params">(QMouseEvent* evt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 接收事件，不往下传递</span></span><br><span class="line">	evt-&gt;accept();</span><br><span class="line">	QPointF pt = evt-&gt;localPos();</span><br><span class="line">	<span class="keyword">this</span>-&gt;meX = pt.x();</span><br><span class="line">	<span class="keyword">this</span>-&gt;meY = pt.y();</span><br><span class="line">	qDebug() &lt;&lt; QString(<span class="string">"ImageViewer::mouseReleaseEvent() - (x=%1, y=%2)"</span>)</span><br><span class="line">		.arg(<span class="keyword">this</span>-&gt;meX).arg(<span class="keyword">this</span>-&gt;meY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImg.data &amp;&amp; <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">height</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>-&gt;mLabel-&gt;<span class="built_in">width</span>() &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		px p;</span><br><span class="line">		<span class="keyword">if</span> (!Calc2D::getPxFromImage(p, cv::Point(<span class="keyword">this</span>-&gt;meX, <span class="keyword">this</span>-&gt;meY), <span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>-&gt;mImgEndX = p.x;</span><br><span class="line">		<span class="keyword">this</span>-&gt;mImgEndY = p.y;</span><br><span class="line">		<span class="function">emit <span class="title">imageMouseMoveEvent</span><span class="params">(p)</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawPoint)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="function">cv::Point2d <span class="title">nPt</span><span class="params">(<span class="keyword">this</span>-&gt;mImgEndX, <span class="keyword">this</span>-&gt;mImgEndY)</span></span>;</span><br><span class="line">			<span class="keyword">this</span>-&gt;mPts.push_back(nPt);</span><br><span class="line">			<span class="function">emit <span class="title">drawNewPoint</span><span class="params">(nPt)</span></span>;</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithPoints(<span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mPts);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawLine)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartX - <span class="keyword">this</span>-&gt;mImgEndX) &gt; <span class="number">1e-5</span> || <span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartY - <span class="keyword">this</span>-&gt;mImgEndY) &gt; <span class="number">1e-5</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				cv::Vec4d nLine(<span class="keyword">this</span>-&gt;mImgStartX, <span class="keyword">this</span>-&gt;mImgStartY, <span class="keyword">this</span>-&gt;mImgEndX, <span class="keyword">this</span>-&gt;mImgEndY);</span><br><span class="line">				<span class="function">emit <span class="title">drawNewLine</span><span class="params">(nLine)</span></span>;</span><br><span class="line">				<span class="keyword">this</span>-&gt;mLines.push_back(nLine);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithLines(<span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mLines);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawRectangle)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartX - <span class="keyword">this</span>-&gt;mImgEndX) &gt; <span class="number">1e-5</span> || <span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartY - <span class="keyword">this</span>-&gt;mImgEndY) &gt; <span class="number">1e-5</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">double</span> x1, y1, x2, y2;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImgStartX &lt;= <span class="keyword">this</span>-&gt;mImgEndX)</span><br><span class="line">				&#123;</span><br><span class="line">					x1 = <span class="keyword">this</span>-&gt;mImgStartX;</span><br><span class="line">					x2 = <span class="keyword">this</span>-&gt;mImgEndX;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					x1 = <span class="keyword">this</span>-&gt;mImgEndX;</span><br><span class="line">					x2 = <span class="keyword">this</span>-&gt;mImgStartX;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mImgStartY &lt;= <span class="keyword">this</span>-&gt;mImgEndY)</span><br><span class="line">				&#123;</span><br><span class="line">					y1 = <span class="keyword">this</span>-&gt;mImgStartY;</span><br><span class="line">					y2 = <span class="keyword">this</span>-&gt;mImgEndY;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					y1 = <span class="keyword">this</span>-&gt;mImgEndY;</span><br><span class="line">					y2 = <span class="keyword">this</span>-&gt;mImgStartY;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="function">cv::Rect2d <span class="title">nRect</span><span class="params">(x1, y1, x2 - x1, y2 - y1)</span></span>;</span><br><span class="line">				<span class="function">emit <span class="title">drawNewRectangle</span><span class="params">(nRect)</span></span>;</span><br><span class="line">				<span class="keyword">this</span>-&gt;mRects.push_back(nRect);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithRectangles(<span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mRects);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;isDrawRotateRectangle)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartX - <span class="keyword">this</span>-&gt;mImgEndX) &gt; <span class="number">1e-5</span> || <span class="built_in">abs</span>(<span class="keyword">this</span>-&gt;mImgStartY - <span class="keyword">this</span>-&gt;mImgEndY) &gt; <span class="number">1e-5</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				RotRect2D nRotRect(cv::Vec4d(<span class="keyword">this</span>-&gt;mImgStartX, <span class="keyword">this</span>-&gt;mImgStartY, <span class="keyword">this</span>-&gt;mImgEndX, <span class="keyword">this</span>-&gt;mImgEndY));</span><br><span class="line">				<span class="function">emit <span class="title">drawNewRotateRectangle</span><span class="params">(nRotRect)</span></span>;</span><br><span class="line">				<span class="keyword">this</span>-&gt;mRotRects.push_back(nRotRect);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;showImageWithRotateRectangles(<span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect, <span class="keyword">this</span>-&gt;mRotRects);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;msX != <span class="keyword">this</span>-&gt;meX || <span class="keyword">this</span>-&gt;msY != <span class="keyword">this</span>-&gt;meY)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">this</span>-&gt;mRect.x += (<span class="keyword">this</span>-&gt;meX - <span class="keyword">this</span>-&gt;msX);</span><br><span class="line">				<span class="keyword">this</span>-&gt;mRect.y += (<span class="keyword">this</span>-&gt;meY - <span class="keyword">this</span>-&gt;msY);</span><br><span class="line">				<span class="keyword">this</span>-&gt;showImage(<span class="keyword">this</span>-&gt;mImg, <span class="keyword">this</span>-&gt;mRect);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="在父组件响应事件"><a href="#在父组件响应事件" class="headerlink" title="在父组件响应事件"></a>在父组件响应事件</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onDrawNewPoint</span><span class="params">(<span class="keyword">const</span> cv::Point2d&amp; pt)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onDrawNewLine</span><span class="params">(<span class="keyword">const</span> cv::Vec4d&amp; <span class="built_in">line</span>)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onDrawNewRectangle</span><span class="params">(<span class="keyword">const</span> cv::Rect2d&amp; <span class="built_in">rect</span>)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onDrawNewRotateRectangle</span><span class="params">(<span class="keyword">const</span> RotRect2D&amp; rotRect)</span></span>;</span><br></pre></td></tr></table></figure>
<p>绑定事件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>-&gt;iViewer, SIGNAL(drawNewPoint(<span class="keyword">const</span> cv::Point2d&amp;)), <span class="keyword">this</span>, SLOT(onDrawNewPoint(<span class="keyword">const</span> cv::Point2d&amp;)));</span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>-&gt;iViewer, SIGNAL(drawNewLine(<span class="keyword">const</span> cv::Vec4d &amp;)), <span class="keyword">this</span>, SLOT(onDrawNewLine(<span class="keyword">const</span> cv::Vec4d&amp;)));</span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>-&gt;iViewer, SIGNAL(drawNewRectangle(<span class="keyword">const</span> cv::Rect2d &amp;)), <span class="keyword">this</span>, SLOT(onDrawNewRectangle(<span class="keyword">const</span> cv::Rect2d &amp;)));</span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>-&gt;iViewer, SIGNAL(drawNewRotateRectangle(<span class="keyword">const</span> RotRect2D &amp;)), <span class="keyword">this</span>, SLOT(onDrawNewRotateRectangle(<span class="keyword">const</span> RotRect2D &amp;)));</span><br></pre></td></tr></table></figure>
<p>事件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KvImage::onDrawNewPoint</span><span class="params">(<span class="keyword">const</span> cv::Point2d&amp; pt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;putText(QString(<span class="string">"Add Point: x=%1, y=%2"</span>).arg(pt.x).arg(pt.y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KvImage::onDrawNewLine</span><span class="params">(<span class="keyword">const</span> cv::Vec4d&amp; <span class="built_in">line</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;putText(QString(<span class="string">"Add Line: (x1, y1)=(%1, %2), (x2, y2)=(%3, %4)"</span>)</span><br><span class="line">		.arg(<span class="built_in">line</span>[<span class="number">0</span>]).arg(<span class="built_in">line</span>[<span class="number">1</span>])</span><br><span class="line">		.arg(<span class="built_in">line</span>[<span class="number">2</span>]).arg(<span class="built_in">line</span>[<span class="number">3</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KvImage::onDrawNewRectangle</span><span class="params">(<span class="keyword">const</span> cv::Rect2d&amp; <span class="built_in">rect</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;putText(QString(<span class="string">"Add Rectangle: x=%1, y=%2, width=%3, height=%4"</span>)</span><br><span class="line">		.arg(<span class="built_in">rect</span>.x).arg(<span class="built_in">rect</span>.y)</span><br><span class="line">		.arg(<span class="built_in">rect</span>.<span class="built_in">width</span>).arg(<span class="built_in">rect</span>.<span class="built_in">height</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KvImage::onDrawNewRotateRectangle</span><span class="params">(<span class="keyword">const</span> RotRect2D&amp; rotRect)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;putText(QString(<span class="string">"Add Rotate Rectangle: (x1, y1)=(%1, %2), (x2, y2)=(%3, %4), (x3, y3)=(%5, %6), (x4, y4)=(%7, %8)"</span>)</span><br><span class="line">		.arg(rotRect.pt1().x).arg(rotRect.pt1().y)</span><br><span class="line">		.arg(rotRect.pt2().x).arg(rotRect.pt2().y)</span><br><span class="line">		.arg(rotRect.pt3().x).arg(rotRect.pt3().y)</span><br><span class="line">		.arg(rotRect.pt4().x).arg(rotRect.pt4().y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="删除矢量"><a href="#删除矢量" class="headerlink" title="删除矢量"></a>删除矢量</h2><p>声明</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">deletePoint</span><span class="params">(<span class="keyword">const</span> cv::Point2d&amp; pt)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">deleteLine</span><span class="params">(<span class="keyword">const</span> cv::Vec4d&amp; <span class="built_in">line</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">deleteRectangle</span><span class="params">(<span class="keyword">const</span> cv::Rect2d&amp; <span class="built_in">rect</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">deleteRotateRectangle</span><span class="params">(<span class="keyword">const</span> RotRect2D&amp; rotRect)</span></span>;</span><br></pre></td></tr></table></figure>
<p>实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">ImageViewer::deletePoint</span><span class="params">(<span class="keyword">const</span> cv::Point2d&amp; pt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2d&gt;::iterator pos = <span class="built_in">std</span>::<span class="built_in">find</span>(<span class="keyword">this</span>-&gt;mPts.<span class="built_in">begin</span>(), <span class="keyword">this</span>-&gt;mPts.<span class="built_in">end</span>(), pt);</span><br><span class="line">	<span class="keyword">if</span> (pos == <span class="keyword">this</span>-&gt;mPts.<span class="built_in">end</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">this</span>-&gt;mPts.erase(pos);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//// 其余类似</span></span><br></pre></td></tr></table></figure>
<h1 id="QTextBrowser滚动到底部"><a href="#QTextBrowser滚动到底部" class="headerlink" title="QTextBrowser滚动到底部"></a>QTextBrowser滚动到底部</h1><p>继承自<a href="https://doc.qt.io/qt-5.12/qtextedit.html#moveCursor" target="_blank" rel="noopener">QTextEdit::moveCursor(QTextCursor::MoveOperation operation, QTextCursor::MoveMode mode = QTextCursor::MoveAnchor)</a></p>
<p>移动操作参考<a href="https://doc.qt.io/qt-5.12/qtextcursor.html#MoveOperation-enum" target="_blank" rel="noopener">QTextCursor::MoveOperation-enum</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;mInfoBar-&gt;moveCursor(QTextCursor::End);  <span class="comment">// 滚动到底部</span></span><br></pre></td></tr></table></figure>
<h1 id="矢量窗口"><a href="#矢量窗口" class="headerlink" title="矢量窗口"></a>矢量窗口</h1><p>用来显示矢量（点线面），并具有选择查看和导出保存的功能。</p>
<h2 id="创建类"><a href="#创建类" class="headerlink" title="创建类"></a>创建类</h2><p>VectorWindow.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VectorWindow</span> :</span></span><br><span class="line">    <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    VectorWindow(QWidget* parent = Q_NULLPTR);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>VectorWindow.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"VectorWindow.h"</span></span></span><br><span class="line"></span><br><span class="line">VectorWindow::VectorWindow(QWidget* parent) : QWidget(parent)</span><br><span class="line">&#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="设置窗体类"><a href="#设置窗体类" class="headerlink" title="设置窗体类"></a>设置窗体类</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////// 初始化窗口</span></span><br><span class="line"><span class="comment">// 设置窗体大小和位置</span></span><br><span class="line">QDesktopWidget* desktopWidget = QApplication::desktop();</span><br><span class="line">QRect deskRect = desktopWidget-&gt;availableGeometry();  <span class="comment">// 可用桌面大小</span></span><br><span class="line"><span class="keyword">int</span> deskHeight, deskWidth;</span><br><span class="line">deskHeight = deskRect.<span class="built_in">height</span>();</span><br><span class="line">deskWidth = deskRect.<span class="built_in">width</span>();</span><br><span class="line"><span class="keyword">int</span> winHeight, winWidth;</span><br><span class="line">winHeight = deskHeight * <span class="number">0.5</span>;</span><br><span class="line">winWidth = deskWidth * <span class="number">0.2</span>;</span><br><span class="line"><span class="keyword">int</span> marginRight;</span><br><span class="line">marginRight = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;setGeometry(deskWidth - winWidth - marginRight, deskHeight / <span class="number">2</span> - winHeight / <span class="number">2</span>, winWidth, winHeight);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 窗体标题</span></span><br><span class="line"><span class="keyword">this</span>-&gt;setWindowTitle(QString::fromLocal8Bit(<span class="string">"矢量窗口"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 窗口最前</span></span><br><span class="line"><span class="keyword">this</span>-&gt;setWindowFlags(<span class="keyword">this</span>-&gt;windowFlags() | Qt::WindowStaysOnTopHint);</span><br><span class="line"><span class="comment">// this-&gt;setWindowFlags(this-&gt;windowFlags() &amp;~ Qt::WindowStaysOnTopHint);  // 取消窗口最前</span></span><br></pre></td></tr></table></figure>
<h2 id="使用按钮控件控制窗体最前"><a href="#使用按钮控件控制窗体最前" class="headerlink" title="使用按钮控件控制窗体最前"></a>使用按钮控件控制窗体最前</h2><p>当当前窗口为隐藏状态时，直接设置其是否顶置；若当前状态为显示，设置顶置方式后窗口会自动隐藏，因此需要额外调用一次<code>show()</code>函数。</p>
<p>创建插槽：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::onToggleTopHint</span><span class="params">(<span class="keyword">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (checked)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 窗口最前</span></span><br><span class="line">		<span class="keyword">if</span> (!isHidden())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>-&gt;setWindowFlags(<span class="keyword">this</span>-&gt;windowFlags() | Qt::WindowStaysOnTopHint);</span><br><span class="line">			<span class="keyword">this</span>-&gt;show();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">this</span>-&gt;setWindowFlags(<span class="keyword">this</span>-&gt;windowFlags() | Qt::WindowStaysOnTopHint);</span><br><span class="line"></span><br><span class="line">		qDebug() &lt;&lt; QString::fromLocal8Bit(<span class="string">"设置窗口最前"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;  <span class="comment">// 取消窗口最前</span></span><br><span class="line">		<span class="keyword">if</span> (!isHidden())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">this</span>-&gt;setWindowFlags(<span class="keyword">this</span>-&gt;windowFlags() &amp; ~Qt::WindowStaysOnTopHint);</span><br><span class="line">			<span class="keyword">this</span>-&gt;show();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">this</span>-&gt;setWindowFlags(<span class="keyword">this</span>-&gt;windowFlags() &amp; ~Qt::WindowStaysOnTopHint);</span><br><span class="line"></span><br><span class="line">		qDebug() &lt;&lt; QString::fromLocal8Bit(<span class="string">"取消窗口最前"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建<a href="https://doc.qt.io/qt-5.12/qradiobutton.html" target="_blank" rel="noopener">QRadioButton</a>按钮并绑定事件：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否顶置按钮</span></span><br><span class="line">QRadioButton* winTopBtn = <span class="keyword">new</span> QRadioButton(<span class="keyword">this</span>);</span><br><span class="line">winTopBtn-&gt;setText(QString::fromLocal8Bit(<span class="string">"顶置窗口"</span>));</span><br><span class="line">QObject::<span class="built_in">connect</span>(winTopBtn, SIGNAL(clicked(<span class="keyword">bool</span>)), <span class="keyword">this</span>, SLOT(onToggleTopHint(<span class="keyword">bool</span>)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;mLayout-&gt;addWidget(winTopBtn, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>);  <span class="comment">// 行，列，行宽，列宽</span></span><br><span class="line"><span class="keyword">if</span> (!winTopBtn-&gt;isChecked()) winTopBtn-&gt;<span class="built_in">click</span>();</span><br></pre></td></tr></table></figure>
<h2 id="使用表格"><a href="#使用表格" class="headerlink" title="使用表格"></a>使用表格</h2><blockquote>
<p><a href="https://blog.csdn.net/xgbing/article/details/7774737" target="_blank" rel="noopener">Qt入门－表格类QTableWidget</a></p>
</blockquote>
<p>QTableWidget继承自QTableView，功能较为齐全。下面是一个使用示例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////////// 设置表格</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置表格行列</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setRowCount(<span class="number">4</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setColumnCount(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置表格行标题</span></span><br><span class="line">QStringList headerLabels;</span><br><span class="line">headerLabels &lt;&lt; <span class="string">"C1"</span> &lt;&lt; <span class="string">"C2"</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setHorizontalHeaderLabels(headerLabels);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置表格行标题的对齐方式</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;horizontalHeader()-&gt;setDefaultAlignment(Qt::AlignCenter);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置行表题</span></span><br><span class="line">QStringList rowLabels;</span><br><span class="line">rowLabels &lt;&lt; <span class="string">"Line1"</span> &lt;&lt; <span class="string">"Line2"</span> &lt;&lt; <span class="string">"Line3"</span> &lt;&lt; <span class="string">"Line4"</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setVerticalHeaderLabels(rowLabels);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动调整最后一列的宽度使它和表格的右边界对齐</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;horizontalHeader()-&gt;setStretchLastSection(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 设置表格宽高调整尺寸策略</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;horizontalHeader()-&gt;setSectionResizeMode(QHeaderView::ResizeMode::Stretch);</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;verticalHeader()-&gt;setSectionResizeMode(QHeaderView::ResizeMode::ResizeToContents);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置表格的选择方式</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setSelectionBehavior(QAbstractItemView::SelectionBehavior::SelectRows);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置编辑方式</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setEditTriggers(QAbstractItemView::EditTrigger::NoEditTriggers);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置表格的内容</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; ++row)</span><br><span class="line">&#123;</span><br><span class="line">    QTableWidgetItem* item0, * item1;</span><br><span class="line">    item0 = <span class="keyword">new</span> QTableWidgetItem;</span><br><span class="line">    item1 = <span class="keyword">new</span> QTableWidgetItem;</span><br><span class="line"></span><br><span class="line">    QString txt = QString(<span class="string">"%1"</span>).arg(row + <span class="number">1</span>);</span><br><span class="line">    item0-&gt;setText(txt);</span><br><span class="line">    <span class="keyword">this</span>-&gt;mTable-&gt;setItem(row, <span class="number">0</span>, item0);</span><br><span class="line"></span><br><span class="line">    txt = QString(<span class="string">"%1"</span>).arg((row + <span class="number">1</span>) * <span class="number">2</span>);</span><br><span class="line">    item1-&gt;setText(txt);</span><br><span class="line">    <span class="keyword">this</span>-&gt;mTable-&gt;setItem(row, <span class="number">1</span>, item1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//增加一行</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setRowCount(<span class="number">5</span>);</span><br><span class="line">QTableWidgetItem* vHeader5 = <span class="keyword">new</span> QTableWidgetItem(<span class="string">"Line5"</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setVerticalHeaderItem(<span class="number">4</span>, vHeader5);</span><br><span class="line"></span><br><span class="line">QTableWidgetItem* item5_0, * item5_1;</span><br><span class="line">item5_0 = <span class="keyword">new</span> QTableWidgetItem;</span><br><span class="line">item5_1 = <span class="keyword">new</span> QTableWidgetItem;</span><br><span class="line">item5_0-&gt;setText(QString(<span class="string">"%1"</span>).arg(<span class="number">5</span>));</span><br><span class="line">item5_1-&gt;setText(QString(<span class="string">"%1"</span>).arg(<span class="number">5</span> * <span class="number">2</span>));</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setItem(<span class="number">4</span>, <span class="number">0</span>, item5_0);</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setItem(<span class="number">4</span>, <span class="number">1</span>, item5_1);</span><br></pre></td></tr></table></figure>
<h2 id="表格初始化"><a href="#表格初始化" class="headerlink" title="表格初始化"></a>表格初始化</h2><p>设置了一些显示参数，如标题字体样式、对齐方式、宽高策略、是否可选中项目等。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::initTable</span><span class="params">(QTableWidget* table)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (table == Q_NULLPTR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mTable != Q_NULLPTR)</span><br><span class="line">		&#123;</span><br><span class="line">			table = <span class="keyword">this</span>-&gt;mTable;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			qWarning() &lt;&lt; QString::fromLocal8Bit(<span class="string">"表格初始化失败"</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置 表格 及 行标题 的对齐方式</span></span><br><span class="line">	table-&gt;horizontalHeader()-&gt;setDefaultAlignment(Qt::AlignCenter);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 设置加粗</span></span><br><span class="line">	QFont headerFont = table-&gt;horizontalHeader()-&gt;font();</span><br><span class="line">	headerFont.setBold(<span class="literal">true</span>);</span><br><span class="line">	table-&gt;horizontalHeader()-&gt;setFont(headerFont);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 自动调整最后一列的宽度使它和表格的右边界对齐</span></span><br><span class="line">	table-&gt;horizontalHeader()-&gt;setStretchLastSection(<span class="literal">true</span>);</span><br><span class="line">	<span class="comment">// 设置表格宽高调整尺寸策略</span></span><br><span class="line">	table-&gt;horizontalHeader()-&gt;setSectionResizeMode(QHeaderView::ResizeMode::Stretch);</span><br><span class="line">	table-&gt;verticalHeader()-&gt;setSectionResizeMode(QHeaderView::ResizeMode::ResizeToContents);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置表格的选择方式</span></span><br><span class="line">	table-&gt;setSelectionBehavior(QAbstractItemView::SelectionBehavior::SelectRows);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置编辑方式</span></span><br><span class="line">	table-&gt;setEditTriggers(QAbstractItemView::EditTrigger::NoEditTriggers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="表格内容操作：不同数据显示的初始化，填充，清空，滚动"><a href="#表格内容操作：不同数据显示的初始化，填充，清空，滚动" class="headerlink" title="表格内容操作：不同数据显示的初始化，填充，清空，滚动"></a>表格内容操作：不同数据显示的初始化，填充，清空，滚动</h2><p>填充数据前应该对表格进行初始化，不同的数据类型具有不同的表头信息</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::initShowPoints</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;clearTable();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setColumnCount(<span class="number">3</span>);  <span class="comment">// id,x,y</span></span><br><span class="line">	QStringList rowHeaderList;</span><br><span class="line">	rowHeaderList &lt;&lt; <span class="string">"ID"</span> &lt;&lt; <span class="string">"x"</span> &lt;&lt; <span class="string">"y"</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setHorizontalHeaderLabels(rowHeaderList);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//// ...</span></span><br></pre></td></tr></table></figure>
<p>填充一行数据：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">VectorWindow::appendPoint</span><span class="params">(<span class="keyword">const</span> cv::Point2d&amp; pt)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mTable == Q_NULLPTR)</span><br><span class="line">	&#123;</span><br><span class="line">		qWarning() &lt;&lt; QString::fromLocal8Bit(<span class="string">"VectorWindow::appendPoint() - 表格未初始化"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> rowCount, colCount;</span><br><span class="line">	rowCount = <span class="keyword">this</span>-&gt;mTable-&gt;rowCount();</span><br><span class="line">	colCount = <span class="keyword">this</span>-&gt;mTable-&gt;columnCount();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (colCount != <span class="number">3</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		qWarning() &lt;&lt; QString::fromLocal8Bit(<span class="string">"VectorWindow::appendPoint() - 列数不一致，当前为(%1)，应为(%2)"</span>)</span><br><span class="line">			.arg(colCount).arg(<span class="number">3</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setRowCount(rowCount + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	QTableWidgetItem* idItem = <span class="keyword">new</span> QTableWidgetItem(QString::number(rowCount));</span><br><span class="line">	QTableWidgetItem* xItem = <span class="keyword">new</span> QTableWidgetItem(QString::number(pt.x));</span><br><span class="line">	QTableWidgetItem* yItem = <span class="keyword">new</span> QTableWidgetItem(QString::number(pt.y));</span><br><span class="line"></span><br><span class="line">	idItem-&gt;setTextAlignment(Qt::AlignCenter);</span><br><span class="line">	xItem-&gt;setTextAlignment(Qt::AlignCenter);</span><br><span class="line">	yItem-&gt;setTextAlignment(Qt::AlignCenter);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setItem(rowCount, <span class="number">0</span>, idItem);</span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setItem(rowCount, <span class="number">1</span>, xItem);</span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setItem(rowCount, <span class="number">2</span>, yItem);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// ...</span></span><br></pre></td></tr></table></figure>
<p>填充列表数据直接循环调用填充单个的即可。</p>
<p>控制表格滚动到底部，一般在插入数据后调用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动到底部</span></span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;scrollToBottom();</span><br></pre></td></tr></table></figure>
<p>清空表格不仅要清空内容，还要把行列设置为0从而清空表头</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::clearTable</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mTable == Q_NULLPTR)</span><br><span class="line">	&#123;</span><br><span class="line">		qWarning() &lt;&lt; QString::fromLocal8Bit(<span class="string">"VectorWindow::clearTable() - 表格未初始化"</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 清空表格</span></span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;clearContents();</span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setRowCount(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">this</span>-&gt;mTable-&gt;setColumnCount(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="表格事件"><a href="#表格事件" class="headerlink" title="表格事件"></a>表格事件</h2><p>当希望点击表格中的矢量定位到矢量在图上的位置时，需要用到表格事件<a href="https://doc.qt.io/qt-5.12/qtablewidget.html#signals" target="_blank" rel="noopener">QTableWidget::signals</a>，这边用到了双击事件<code>cellDoubleClicked(int row, int col)</code>。</p>
<p>创建槽函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemDoubleClicked</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::onItemDoubleClicked</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qDebug() &lt;&lt; row &lt;&lt; <span class="string">", "</span> &lt;&lt; col;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绑定信号</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定事件</span></span><br><span class="line">QObject::<span class="built_in">connect</span>(<span class="keyword">this</span>-&gt;mTable, SIGNAL(cellDoubleClicked(<span class="keyword">int</span>, <span class="keyword">int</span>)), <span class="keyword">this</span>, SLOT(onItemDoubleClicked(<span class="keyword">int</span>, <span class="keyword">int</span>)));</span><br></pre></td></tr></table></figure>
<h2 id="表格内的操作按钮"><a href="#表格内的操作按钮" class="headerlink" title="表格内的操作按钮"></a>表格内的操作按钮</h2><blockquote>
<p><a href="https://blog.csdn.net/GiveMeFive_Y/article/details/89535830" target="_blank" rel="noopener">QT表格列添加多个按钮</a></p>
</blockquote>
<p>当希望删除矢量时，可以借助每个矢量后面的操作按钮完成。</p>
<h3 id="创建按钮"><a href="#创建按钮" class="headerlink" title="创建按钮"></a>创建按钮</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QWidget* <span class="title">VectorWindow::createRowCtrlBtnWidget</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	QWidget* w = <span class="keyword">new</span> QWidget();</span><br><span class="line"></span><br><span class="line">	QPushButton* viewBtn = <span class="keyword">new</span> QPushButton(QString::fromLocal8Bit(<span class="string">"查看"</span>));</span><br><span class="line">	QPushButton* delBtn = <span class="keyword">new</span> QPushButton(QString::fromLocal8Bit(<span class="string">"删除"</span>));</span><br><span class="line">	QHBoxLayout* layout = <span class="keyword">new</span> QHBoxLayout(); <span class="comment">//添加水平布局控件</span></span><br><span class="line">	QWidget* widget = <span class="keyword">new</span> QWidget(); <span class="comment">//添加部件</span></span><br><span class="line"></span><br><span class="line">	viewBtn-&gt;setStyleSheet(<span class="string">"QPushButton&#123;margin:0;padding:0;color:blue;border:none;background-color:rgba(0,0,0,0);&#125;\</span></span><br><span class="line"><span class="string">		QPushButton:hover&#123;font-weight:bold;text-decoration:underline;&#125;"</span>);</span><br><span class="line">	viewBtn-&gt;<span class="built_in">setCursor</span>(Qt::PointingHandCursor);</span><br><span class="line"></span><br><span class="line">	delBtn-&gt;setStyleSheet(<span class="string">"QPushButton&#123;margin:0;padding:0;color:blue;border:none;background-color:rgba(0,0,0,0);&#125;\</span></span><br><span class="line"><span class="string">		QPushButton:hover&#123;font-weight:bold;text-decoration:underline;&#125;"</span>);</span><br><span class="line">	delBtn-&gt;<span class="built_in">setCursor</span>(Qt::PointingHandCursor);</span><br><span class="line"></span><br><span class="line">	QObject::<span class="built_in">connect</span>(viewBtn, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(onViewRow()));</span><br><span class="line">	QObject::<span class="built_in">connect</span>(delBtn, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(onRemoveRow()));</span><br><span class="line"></span><br><span class="line">	layout-&gt;addWidget(viewBtn);</span><br><span class="line">	layout-&gt;addWidget(delBtn);</span><br><span class="line">	layout-&gt;setContentsMargins(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	layout-&gt;setAlignment(Qt::AlignCenter);</span><br><span class="line">	w-&gt;setLayout(layout);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> w;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加到表格中：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QWidget* btnWidget = <span class="keyword">this</span>-&gt;createRowCtrlBtnWidget();</span><br><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setCellWidget(rowCount, <span class="number">3</span>, btnWidget);</span><br></pre></td></tr></table></figure>
<h3 id="获取行号：使用sender-函数"><a href="#获取行号：使用sender-函数" class="headerlink" title="获取行号：使用sender()函数"></a>获取行号：使用sender()函数</h3><blockquote>
<p><a href="https://blog.csdn.net/u013394556/article/details/39965667" target="_blank" rel="noopener">Qt中QObject::sender()的用法</a></p>
</blockquote>
<p>当某一个<code>Object</code>emit一个signal的时候，它就是一个sender。系统会记录下当前是谁emit出这个signal的，所以你在对应的slot里就可以通过<code>sender()</code>得到当前是谁invoke了你的slot。</p>
<p>在如下例子中，<code>onEditRow()</code>函数作为表格项按钮的响应函数，其<code>sender</code>就是按钮本身，而按钮的父组件是添加到表格中的widget，其<code>pos()</code>函数的返回值是其在表格中左上角的位置坐标。因此通过表格的<code>indexAt()</code>函数可以反算出行号。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::onEditRow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	QWidget* w = qobject_cast&lt;QWidget*&gt;(sender()-&gt;parent());</span><br><span class="line">	<span class="keyword">if</span> (w)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> row = <span class="keyword">this</span>-&gt;mTable-&gt;indexAt(w-&gt;pos()).row();</span><br><span class="line">		qDebug() &lt;&lt; row;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有一种思路是将行号作为属性（property）存放到每一行的操作按钮控件中，但是由于表格的删除操作，实际的行号可能随时发生变化，那么创建一个表格行时生成的操作按钮里记录的行号就过时了，因此不适合作为属性传入，这里采用实时计算的方式较为合适。作为属性传入的见下一节，在右键点击菜单中，菜单的生成是实时的，此时的行号具有时效性。</p>
<h2 id="右键点击操作"><a href="#右键点击操作" class="headerlink" title="右键点击操作"></a>右键点击操作</h2><blockquote>
<p><a href="https://blog.csdn.net/TanChengkai/article/details/52104924" target="_blank" rel="noopener">QT实现鼠标右键快捷菜单(QTableWidget)</a></p>
</blockquote>
<p>右键点击一个项目进行删除或者复制到剪贴板。</p>
<p>QTableWidget的点击事件关联的都是鼠标左键，只有<code>customContextMenuRequested(QPoint)</code>信号是QWidget中唯一的右键菜单点击的信号，且该信号的触发条件是QWidget的上下文菜单策略（ContextMenuPolicy）设置为<code>Qt::CustomContextMenu</code>。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;mTable-&gt;setContextMenuPolicy(Qt::CustomContextMenu);</span><br></pre></td></tr></table></figure>
<p>响应事件:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">VectorWindow::onTableRightClicked</span><span class="params">(<span class="keyword">const</span> QPoint pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qDebug() &lt;&lt; pos;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;mVecType == Kv::VectorType::None)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	QModelIndex idx = <span class="keyword">this</span>-&gt;mTable-&gt;indexAt(pos);</span><br><span class="line">	qDebug() &lt;&lt; idx;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (idx.row() &lt; <span class="number">0</span> || idx.column() &lt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	QMenu* menu = <span class="keyword">new</span> QMenu(<span class="keyword">this</span>-&gt;mTable);</span><br><span class="line">	QAction* actView = <span class="keyword">new</span> QAction(QString::fromLocal8Bit(<span class="string">"查看"</span>), <span class="keyword">this</span>-&gt;mTable);</span><br><span class="line">	QAction* actDel = <span class="keyword">new</span> QAction(QString::fromLocal8Bit(<span class="string">"删除"</span>), <span class="keyword">this</span>-&gt;mTable);</span><br><span class="line">	actView-&gt;setProperty(<span class="string">"row"</span>, QVariant(idx.row()));</span><br><span class="line">	actDel-&gt;setProperty(<span class="string">"row"</span>, QVariant(idx.row()));</span><br><span class="line">	QObject::<span class="built_in">connect</span>(actView, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onViewRow()));</span><br><span class="line">	QObject::<span class="built_in">connect</span>(actDel, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onRemoveRow()));</span><br><span class="line"></span><br><span class="line">	menu-&gt;addAction(actView);</span><br><span class="line">	menu-&gt;addAction(actDel);</span><br><span class="line">	menu-&gt;<span class="built_in">move</span>(<span class="built_in">cursor</span>().pos());</span><br><span class="line">	menu-&gt;show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>右键菜单中添加的动作与表格内按钮的动作可能用到相同的响应函数，例如矢量的查看和删除。在表格按钮中，行号的获取是通过表单控件的位置计算出来的，由于表格行数随时可能发生变化，因此通过实时计算的方式可以保证行号的正确；而在右键菜单中，其生成和消失是根据当前鼠标位置决定的，并不会和每一行数据进行绑定，因此通过属性设置行号即可完成功能。</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C++</a>
              <a href="/tags/Qt/" rel="tag"><i class="fa fa-tag"></i> Qt</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/27/%E5%85%B3%E4%BA%8E%E4%BA%8C%E7%BB%B4%E6%97%8B%E8%BD%AC%E7%9A%84%E7%90%86%E8%A7%A3/" rel="prev" title="关于二维旋转的理解">
      <i class="fa fa-chevron-left"></i> 关于二维旋转的理解
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/05/23/C-%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF%E8%BE%93%E5%87%BA%E7%B1%BB/" rel="next" title="C++调试信息输出类">
      C++调试信息输出类 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#修改QAction"><span class="nav-text">修改QAction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#获取action"><span class="nav-text">获取action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取-amp-修改文字"><span class="nav-text">获取&amp;修改文字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置是否可选"><span class="nav-text">设置是否可选</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#遍历一个QMenu下的所有QAction"><span class="nav-text">遍历一个QMenu下的所有QAction</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#鼠标滚轮事件"><span class="nav-text">鼠标滚轮事件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#判断当前按钮"><span class="nav-text">判断当前按钮</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缩放控制"><span class="nav-text">缩放控制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#矢量绘图功能"><span class="nav-text">矢量绘图功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#存储绘图图形数据的变量"><span class="nav-text">存储绘图图形数据的变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类接口：启动和关闭绘图"><span class="nav-text">类接口：启动和关闭绘图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#静态函数：在图像上绘制图形"><span class="nav-text">静态函数：在图像上绘制图形</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图形绘制后触发的事件"><span class="nav-text">图形绘制后触发的事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在图像窗口显示带矢量图形的图片"><span class="nav-text">在图像窗口显示带矢量图形的图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#绘图的关键：鼠标事件"><span class="nav-text">绘图的关键：鼠标事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在父组件响应事件"><span class="nav-text">在父组件响应事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除矢量"><span class="nav-text">删除矢量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#QTextBrowser滚动到底部"><span class="nav-text">QTextBrowser滚动到底部</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#矢量窗口"><span class="nav-text">矢量窗口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建类"><span class="nav-text">创建类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置窗体类"><span class="nav-text">设置窗体类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用按钮控件控制窗体最前"><span class="nav-text">使用按钮控件控制窗体最前</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用表格"><span class="nav-text">使用表格</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表格初始化"><span class="nav-text">表格初始化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表格内容操作：不同数据显示的初始化，填充，清空，滚动"><span class="nav-text">表格内容操作：不同数据显示的初始化，填充，清空，滚动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表格事件"><span class="nav-text">表格事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表格内的操作按钮"><span class="nav-text">表格内的操作按钮</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建按钮"><span class="nav-text">创建按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取行号：使用sender-函数"><span class="nav-text">获取行号：使用sender()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#右键点击操作"><span class="nav-text">右键点击操作</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="林杉"
      src="/images/blog/avatar_136x136.png">
  <p class="site-author-name" itemprop="name">林杉</p>
  <div class="site-description" itemprop="description">开发记录 & 思考笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">66</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">林杉</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">313k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:45</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '77edc458d1e975c91584',
      clientSecret: 'd066ea784ad9a8840650ce87154372d890562ecc',
      repo        : 'whuls.github.io',
      owner       : 'WHULS',
      admin       : ['WHULS'],
      id          : '936ddcb53c93672a6479180c7f06fd0d',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
